'use strict';

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var Ball = function () {
    function Ball(scene, spawnPosition, ballId) {
        var color = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 1;

        _classCallCheck(this, Ball);

        this.minBallSpeed = 5;
        this.maxBallSpeed = 20;

        this.ball = BABYLON.MeshBuilder.CreateSphere('playBall', {
            segments: 16,
            diameter: 1
        }, scene);
        this.ball.physicsImpostor = new BABYLON.PhysicsImpostor(this.ball, BABYLON.PhysicsImpostor.SphereImpostor, {
            mass: 1,
            friction: 0,
            restitution: 1
        }, scene);
        this.ball.position = spawnPosition;
        this.ball.physicsImpostor.uniqueId = ballId;

        this.initialPosition = spawnPosition.clone();
        this.isLaunched = false;
        this.color = color;
    }

    _createClass(Ball, [{
        key: 'lockPositionToPlayerPaddle',
        value: function lockPositionToPlayerPaddle(playerPaddleVelocity) {
            this.ball.physicsImpostor.setLinearVelocity(playerPaddleVelocity);
        }
    }, {
        key: 'launchBall',
        value: function launchBall(keyStates, playerPaddleVelocity) {
            if (keyStates[32]) {
                this.isLaunched = true;

                this.ball.physicsImpostor.setLinearVelocity(new BABYLON.Vector3(playerPaddleVelocity.x, 0, Math.random() * 10));
            }
        }
    }, {
        key: 'setCollisionComponents',
        value: function setCollisionComponents(impostersArray) {
            this.ball.physicsImpostor.registerOnPhysicsCollide(impostersArray, this.onTriggerEnter);
        }
    }, {
        key: 'onTriggerEnter',
        value: function onTriggerEnter(ballPhysicsImposter, collidedAgainst) {
            var velocityX = collidedAgainst.getLinearVelocity().x;
            var velocityXBall = ballPhysicsImposter.getLinearVelocity().x;
            var velocityZ = -ballPhysicsImposter.getLinearVelocity().z;

            ballPhysicsImposter.setLinearVelocity(new BABYLON.Vector3(velocityX - velocityXBall, 0, velocityZ));

            collidedAgainst.setAngularVelocity(BABYLON.Vector3.Zero());
        }
    }, {
        key: 'limitBallVelocity',
        value: function limitBallVelocity() {
            var velocity = this.ball.physicsImpostor.getLinearVelocity();

            var velocityZ = velocity.z;
            var velocityZAbs = Math.abs(velocityZ);
            var clampedVelocityZ = BABYLON.MathTools.Clamp(velocityZAbs, this.minBallSpeed, this.maxBallSpeed);
            var direction = Math.sign(velocityZ);

            var velocityX = velocity.x;
            var velocityY = velocity.y;

            this.ball.physicsImpostor.setLinearVelocity(new BABYLON.Vector3(velocityX, velocityY, clampedVelocityZ * direction));
        }
    }, {
        key: 'update',
        value: function update(keyStates, playerPaddleVelocity) {
            if (this.isLaunched) {
                this.limitBallVelocity();
            } else {
                this.lockPositionToPlayerPaddle(playerPaddleVelocity);
                this.launchBall(keyStates, playerPaddleVelocity);
            }
        }
    }, {
        key: 'resetBallStats',
        value: function resetBallStats() {
            this.ball.position = this.initialPosition;
            this.isLaunched = false;
            this.ball.physicsImpostor.setLinearVelocity(BABYLON.Vector3.Zero());
            this.ball.physicsImpostor.setAngularVelocity(BABYLON.Vector3.Zero());
        }
    }]);

    return Ball;
}();

var Paddle = function () {
    function Paddle(name, scene, spawnPosition, paddleId, isAI) {
        var color = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : 1;

        _classCallCheck(this, Paddle);

        this.paddle = BABYLON.MeshBuilder.CreateBox('paddle_' + name, {
            width: 5,
            height: 1,
            depth: 1
        }, scene);
        this.paddle.position = spawnPosition;
        this.paddle.physicsImpostor = new BABYLON.PhysicsImpostor(this.paddle, BABYLON.PhysicsImpostor.BoxImpostor, {
            mass: 1,
            friction: 0,
            restitution: 0
        }, scene);
        this.paddle.physicsImpostor.setLinearVelocity(BABYLON.Vector3.Zero());
        this.paddle.physicsImpostor.uniqueId = paddleId;

        this.initialPosition = spawnPosition.clone();
        this.color = color;
        this.movementSpeed = 5;

        this.isAI = isAI;
    }

    _createClass(Paddle, [{
        key: 'movePaddle',
        value: function movePaddle(keyStates) {
            if (keyStates[37]) {
                this.paddle.physicsImpostor.setLinearVelocity(BABYLON.Vector3.Left().scale(this.movementSpeed));
            } else if (keyStates[39]) {
                this.paddle.physicsImpostor.setLinearVelocity(BABYLON.Vector3.Right().scale(this.movementSpeed));
            }

            if (!keyStates[37] && !keyStates[39] || keyStates[37] && keyStates[39]) this.paddle.physicsImpostor.setLinearVelocity(BABYLON.Vector3.Zero());
        }
    }, {
        key: 'movePaddleAI',
        value: function movePaddleAI(ballMesh) {
            var desiredDirection = Math.sign(ballMesh.position.x - this.paddle.position.x);

            if (desiredDirection === -1) {
                this.paddle.physicsImpostor.setLinearVelocity(BABYLON.Vector3.Left().scale(this.movementSpeed));
            } else if (desiredDirection === 1) {
                this.paddle.physicsImpostor.setLinearVelocity(BABYLON.Vector3.Right().scale(this.movementSpeed));
            } else {
                this.paddle.physicsImpostor.setLinearVelocity(BABYLON.Vector3.Zero());
            }
        }
    }, {
        key: 'update',
        value: function update(keyStates, ball) {
            if (!this.isAI) this.movePaddle(keyStates);else this.movePaddleAI(ball);

            this.paddle.physicsImpostor.setAngularVelocity(BABYLON.Vector3.Zero());
        }
    }, {
        key: 'resetPaddle',
        value: function resetPaddle() {
            this.paddle.position = this.initialPosition;
            this.paddle.physicsImpostor.setLinearVelocity(BABYLON.Vector3.Zero());
            this.paddle.physicsImpostor.setAngularVelocity(BABYLON.Vector3.Zero());
        }
    }]);

    return Paddle;
}();

var canvasHolder = document.getElementById('canvas-holder');
var canvas = document.createElement('canvas');
canvas.width = window.innerWidth - 25;
canvas.height = window.innerHeight - 30;
canvasHolder.appendChild(canvas);
var engine = new BABYLON.Engine(canvas, true);

var keyStates = {
    32: false,
    37: false,
    38: false,
    39: false,
    40: false };
window.addEventListener('keydown', function (event) {
    if (event.keyCode in keyStates) keyStates[event.keyCode] = true;
});
window.addEventListener('keyup', function (event) {
    if (event.keyCode in keyStates) keyStates[event.keyCode] = false;
});

var createScene = function createScene() {
    var scene = new BABYLON.Scene(engine);
    scene.enablePhysics(new BABYLON.Vector3(0, -9.81, 0), new BABYLON.CannonJSPlugin());
    scene.collisionsEnabled = true;
    scene.workerCollisions = true;

    var camera = new BABYLON.FreeCamera('mainCamera', new BABYLON.Vector3(0, 20, -60), scene);
    camera.setTarget(BABYLON.Vector3.Zero());

    var light = new BABYLON.HemisphericLight('mainLight', new BABYLON.Vector3(0, 1, 0), scene);

    var ground = BABYLON.MeshBuilder.CreateGround('mainGround', {
        width: 32,
        height: 70,
        subdivisions: 2
    }, scene);
    ground.position = BABYLON.Vector3.Zero();
    ground.physicsImpostor = new BABYLON.PhysicsImpostor(ground, BABYLON.PhysicsImpostor.BoxImpostor, {
        mass: 0,
        friction: 0,
        restitution: 0
    }, scene);

    var leftBar = BABYLON.MeshBuilder.CreateBox('leftBar', {
        width: 2,
        height: 2,
        depth: 70
    }, scene);
    leftBar.position = new BABYLON.Vector3(-15, 1, 0);
    leftBar.physicsImpostor = new BABYLON.PhysicsImpostor(leftBar, BABYLON.PhysicsImpostor.BoxImpostor, {
        mass: 0,
        friction: 0,
        restitution: 1
    });

    var rightBar = BABYLON.MeshBuilder.CreateBox('rightBar', {
        width: 2,
        height: 2,
        depth: 70
    }, scene);
    rightBar.position = new BABYLON.Vector3(15, 1, 0);
    rightBar.physicsImpostor = new BABYLON.PhysicsImpostor(rightBar, BABYLON.PhysicsImpostor.BoxImpostor, {
        mass: 0,
        friction: 0,
        restitution: 1
    });

    return scene;
};
var scene = createScene();


var player_1 = new Paddle('player_1', scene, new BABYLON.Vector3(0, 0.5, -34), 2, false);
var aiPlayer = new Paddle('aiPlayer', scene, new BABYLON.Vector3(0, 0.5, 34), 3, true);

var playingBall = new Ball(scene, new BABYLON.Vector3(0, 0.5, -33), 1);
playingBall.setCollisionComponents([player_1.paddle.physicsImpostor, aiPlayer.paddle.physicsImpostor]);

var scoreBoard = BABYLON.MeshBuilder.CreatePlane('scoreBoard', {
    height: 16,
    width: 32,
    sideOrientation: BABYLON.Mesh.DOUBLESIDE
}, scene);
scoreBoard.position = new BABYLON.Vector3(0, 16, 36);

var ballResetCollider = BABYLON.MeshBuilder.CreateGround('ballCollider', {
    width: 64,
    height: 140,
    subdivisions: 2
}, scene);
ballResetCollider.position = new BABYLON.Vector3(0, -2, 0);
ballResetCollider.physicsImpostor = new BABYLON.PhysicsImpostor(ballResetCollider, BABYLON.PhysicsImpostor.BoxImpostor, {
    mass: 0,
    friction: 0,
    restitution: 0
});
ballResetCollider.physicsImpostor.registerOnPhysicsCollide(playingBall.ball.physicsImpostor, function (thisColliderImposter, ballImposter) {});

engine.runRenderLoop(function () {
    playingBall.update(keyStates, player_1.paddle.physicsImpostor.getLinearVelocity());
    player_1.update(keyStates, playingBall.ball);
    aiPlayer.update(keyStates, playingBall.ball);

    ballResetCollider.physicsImpostor.setLinearVelocity(BABYLON.Vector3.Zero());
    ballResetCollider.physicsImpostor.setAngularVelocity(BABYLON.Vector3.Zero());

    scene.render();
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImJ1bmRsZS5qcyJdLCJuYW1lcyI6WyJCYWxsIiwic2NlbmUiLCJzcGF3blBvc2l0aW9uIiwiYmFsbElkIiwiY29sb3IiLCJtaW5CYWxsU3BlZWQiLCJtYXhCYWxsU3BlZWQiLCJiYWxsIiwiQkFCWUxPTiIsIk1lc2hCdWlsZGVyIiwiQ3JlYXRlU3BoZXJlIiwic2VnbWVudHMiLCJkaWFtZXRlciIsInBoeXNpY3NJbXBvc3RvciIsIlBoeXNpY3NJbXBvc3RvciIsIlNwaGVyZUltcG9zdG9yIiwibWFzcyIsImZyaWN0aW9uIiwicmVzdGl0dXRpb24iLCJwb3NpdGlvbiIsInVuaXF1ZUlkIiwiaW5pdGlhbFBvc2l0aW9uIiwiY2xvbmUiLCJpc0xhdW5jaGVkIiwicGxheWVyUGFkZGxlVmVsb2NpdHkiLCJzZXRMaW5lYXJWZWxvY2l0eSIsImtleVN0YXRlcyIsIlZlY3RvcjMiLCJ4IiwiTWF0aCIsInJhbmRvbSIsImltcG9zdGVyc0FycmF5IiwicmVnaXN0ZXJPblBoeXNpY3NDb2xsaWRlIiwib25UcmlnZ2VyRW50ZXIiLCJiYWxsUGh5c2ljc0ltcG9zdGVyIiwiY29sbGlkZWRBZ2FpbnN0IiwidmVsb2NpdHlYIiwiZ2V0TGluZWFyVmVsb2NpdHkiLCJ2ZWxvY2l0eVhCYWxsIiwidmVsb2NpdHlaIiwieiIsInNldEFuZ3VsYXJWZWxvY2l0eSIsIlplcm8iLCJ2ZWxvY2l0eSIsInZlbG9jaXR5WkFicyIsImFicyIsImNsYW1wZWRWZWxvY2l0eVoiLCJNYXRoVG9vbHMiLCJDbGFtcCIsImRpcmVjdGlvbiIsInNpZ24iLCJ2ZWxvY2l0eVkiLCJ5IiwibGltaXRCYWxsVmVsb2NpdHkiLCJsb2NrUG9zaXRpb25Ub1BsYXllclBhZGRsZSIsImxhdW5jaEJhbGwiLCJQYWRkbGUiLCJuYW1lIiwicGFkZGxlSWQiLCJpc0FJIiwicGFkZGxlIiwiQ3JlYXRlQm94Iiwid2lkdGgiLCJoZWlnaHQiLCJkZXB0aCIsIkJveEltcG9zdG9yIiwibW92ZW1lbnRTcGVlZCIsIkxlZnQiLCJzY2FsZSIsIlJpZ2h0IiwiYmFsbE1lc2giLCJkZXNpcmVkRGlyZWN0aW9uIiwibW92ZVBhZGRsZSIsIm1vdmVQYWRkbGVBSSIsImNhbnZhc0hvbGRlciIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJjYW52YXMiLCJjcmVhdGVFbGVtZW50Iiwid2luZG93IiwiaW5uZXJXaWR0aCIsImlubmVySGVpZ2h0IiwiYXBwZW5kQ2hpbGQiLCJlbmdpbmUiLCJFbmdpbmUiLCJhZGRFdmVudExpc3RlbmVyIiwiZXZlbnQiLCJrZXlDb2RlIiwiY3JlYXRlU2NlbmUiLCJTY2VuZSIsImVuYWJsZVBoeXNpY3MiLCJDYW5ub25KU1BsdWdpbiIsImNvbGxpc2lvbnNFbmFibGVkIiwid29ya2VyQ29sbGlzaW9ucyIsImNhbWVyYSIsIkZyZWVDYW1lcmEiLCJzZXRUYXJnZXQiLCJsaWdodCIsIkhlbWlzcGhlcmljTGlnaHQiLCJncm91bmQiLCJDcmVhdGVHcm91bmQiLCJzdWJkaXZpc2lvbnMiLCJsZWZ0QmFyIiwicmlnaHRCYXIiLCJwbGF5ZXJfMSIsImFpUGxheWVyIiwicGxheWluZ0JhbGwiLCJzZXRDb2xsaXNpb25Db21wb25lbnRzIiwic2NvcmVCb2FyZCIsIkNyZWF0ZVBsYW5lIiwic2lkZU9yaWVudGF0aW9uIiwiTWVzaCIsIkRPVUJMRVNJREUiLCJiYWxsUmVzZXRDb2xsaWRlciIsInRoaXNDb2xsaWRlckltcG9zdGVyIiwiYmFsbEltcG9zdGVyIiwicnVuUmVuZGVyTG9vcCIsInVwZGF0ZSIsInJlbmRlciJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0lBRU1BLEk7QUFDRixrQkFBWUMsS0FBWixFQUFtQkMsYUFBbkIsRUFBa0NDLE1BQWxDLEVBQXFEO0FBQUEsWUFBWEMsS0FBVyx1RUFBSCxDQUFHOztBQUFBOztBQUNqRCxhQUFLQyxZQUFMLEdBQW9CLENBQXBCO0FBQ0EsYUFBS0MsWUFBTCxHQUFvQixFQUFwQjs7QUFFQSxhQUFLQyxJQUFMLEdBQVlDLFFBQVFDLFdBQVIsQ0FBb0JDLFlBQXBCLENBQWlD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d0JBQWxDLENBQ0kwRSxZQUFZbkcsSUFBWixDQUFpQk0sZUFEckIsRUFFSSxVQUFDcUcsb0JBQUQsRUFBdUJDLFlBQXZCLEVBQXdDLENBRXZDLENBSkw7O0FBTUFoQyxPQUFPaUMsYUFBUCxDQUFxQixZQUFNO0FBQ3ZCVixnQkFBWVcsTUFBWixDQUFtQjNGLFNBQW5CLEVBQThCOEUsU0FBUzVDLE1BQVQsQ0FBZ0IvQyxlQUFoQixDQUFnQ3dCLGlCQUFoQyxFQUE5QjtBQUNBbUUsYUFBU2EsTUFBVCxDQUFnQjNGLFNBQWhCLEVBQTJCZ0YsWUFBWW5HLElBQXZDO0FBQ0FrRyxhQUFTWSxNQUFULENBQWdCM0YsU0FBaEIsRUFBMkJnRixZQUFZbkcsSUFBdkM7O0FBRUEwRyxzQkFBa0JwRyxlQUFsQixDQUFrQ1ksaUJBQWxDLENBQW9EakIsUUFBUW1CLE9BQVIsQ0FBZ0JlLElBQWhCLEVBQXBEO0FBQ0F1RSxzQkFBa0JwRyxlQUFsQixDQUFrQzRCLGtCQUFsQyxDQUFxRGpDLFFBQVFtQixPQUFSLENBQWdCZSxJQUFoQixFQUFyRDs7QUFFQXpDLFVBQU1xSCxNQUFOO0FBQ0gsQ0FURCIsImZpbGUiOiJidW5kbGUuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLy8gPHJlZmVyZW5jZSBwYXRoPVwiLi8uLi8uLi90eXBpbmdzL2JhYnlsb24uZC50c1wiIC8+XHJcblxyXG5jbGFzcyBCYWxsIHtcclxuICAgIGNvbnN0cnVjdG9yKHNjZW5lLCBzcGF3blBvc2l0aW9uLCBiYWxsSWQsIGNvbG9yID0gMSkge1xyXG4gICAgICAgIHRoaXMubWluQmFsbFNwZWVkID0gNTtcclxuICAgICAgICB0aGlzLm1heEJhbGxTcGVlZCA9IDIwO1xyXG5cclxuICAgICAgICB0aGlzLmJhbGwgPSBCQUJZTE9OLk1lc2hCdWlsZGVyLkNyZWF0ZVNwaGVyZSgncGxheUJhbGwnLCB7XHJcbiAgICAgICAgICAgIHNlZ21lbnRzOiAxNixcclxuICAgICAgICAgICAgZGlhbWV0ZXI6IDFcclxuICAgICAgICB9LCBzY2VuZSk7XHJcbiAgICAgICAgdGhpcy5iYWxsLnBoeXNpY3NJbXBvc3RvciA9IG5ldyBCQUJZTE9OLlBoeXNpY3NJbXBvc3RvcihcclxuICAgICAgICAgICAgdGhpcy5iYWxsLFxyXG4gICAgICAgICAgICBCQUJZTE9OLlBoeXNpY3NJbXBvc3Rvci5TcGhlcmVJbXBvc3Rvciwge1xyXG4gICAgICAgICAgICAgICAgbWFzczogMSxcclxuICAgICAgICAgICAgICAgIGZyaWN0aW9uOiAwLFxyXG4gICAgICAgICAgICAgICAgcmVzdGl0dXRpb246IDFcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgc2NlbmVcclxuICAgICAgICApO1xyXG4gICAgICAgIHRoaXMuYmFsbC5wb3NpdGlvbiA9IHNwYXduUG9zaXRpb247XHJcbiAgICAgICAgdGhpcy5iYWxsLnBoeXNpY3NJbXBvc3Rvci51bmlxdWVJZCA9IGJhbGxJZDtcclxuXHJcbiAgICAgICAgdGhpcy5pbml0aWFsUG9zaXRpb24gPSBzcGF3blBvc2l0aW9uLmNsb25lKCk7XHJcbiAgICAgICAgdGhpcy5pc0xhdW5jaGVkID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5jb2xvciA9IGNvbG9yO1xyXG4gICAgfVxyXG5cclxuICAgIGxvY2tQb3NpdGlvblRvUGxheWVyUGFkZGxlKHBsYXllclBhZGRsZVZlbG9jaXR5KSB7XHJcbiAgICAgICAgdGhpcy5iYWxsLnBoeXNpY3NJbXBvc3Rvci5zZXRMaW5lYXJWZWxvY2l0eShwbGF5ZXJQYWRkbGVWZWxvY2l0eSk7XHJcbiAgICB9XHJcblxyXG4gICAgbGF1bmNoQmFsbChrZXlTdGF0ZXMsIHBsYXllclBhZGRsZVZlbG9jaXR5KSB7XHJcbiAgICAgICAgaWYgKGtleVN0YXRlc1szMl0pIHtcclxuICAgICAgICAgICAgdGhpcy5pc0xhdW5jaGVkID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuYmFsbC5waHlzaWNzSW1wb3N0b3Iuc2V0TGluZWFyVmVsb2NpdHkoXHJcbiAgICAgICAgICAgICAgICBuZXcgQkFCWUxPTi5WZWN0b3IzKFxyXG4gICAgICAgICAgICAgICAgICAgIHBsYXllclBhZGRsZVZlbG9jaXR5LngsXHJcbiAgICAgICAgICAgICAgICAgICAgMCxcclxuICAgICAgICAgICAgICAgICAgICBNYXRoLnJhbmRvbSgpICogMTBcclxuICAgICAgICAgICAgICAgIClcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgc2V0Q29sbGlzaW9uQ29tcG9uZW50cyhpbXBvc3RlcnNBcnJheSkge1xyXG4gICAgICAgIHRoaXMuYmFsbC5waHlzaWNzSW1wb3N0b3IucmVnaXN0ZXJPblBoeXNpY3NDb2xsaWRlKGltcG9zdGVyc0FycmF5LCB0aGlzLm9uVHJpZ2dlckVudGVyKTtcclxuICAgIH1cclxuXHJcbiAgICBvblRyaWdnZXJFbnRlcihiYWxsUGh5c2ljc0ltcG9zdGVyLCBjb2xsaWRlZEFnYWluc3QpIHtcclxuICAgICAgICBsZXQgdmVsb2NpdHlYID0gY29sbGlkZWRBZ2FpbnN0LmdldExpbmVhclZlbG9jaXR5KCkueDtcclxuICAgICAgICBsZXQgdmVsb2NpdHlYQmFsbCA9IGJhbGxQaHlzaWNzSW1wb3N0ZXIuZ2V0TGluZWFyVmVsb2NpdHkoKS54O1xyXG4gICAgICAgIGxldCB2ZWxvY2l0eVogPSAtYmFsbFBoeXNpY3NJbXBvc3Rlci5nZXRMaW5lYXJWZWxvY2l0eSgpLno7XHJcblxyXG4gICAgICAgIGJhbGxQaHlzaWNzSW1wb3N0ZXIuc2V0TGluZWFyVmVsb2NpdHkoXHJcbiAgICAgICAgICAgIG5ldyBCQUJZTE9OLlZlY3RvcjMoXHJcbiAgICAgICAgICAgICAgICB2ZWxvY2l0eVggLSB2ZWxvY2l0eVhCYWxsLFxyXG4gICAgICAgICAgICAgICAgMCxcclxuICAgICAgICAgICAgICAgIHZlbG9jaXR5WlxyXG4gICAgICAgICAgICApKTtcclxuXHJcbiAgICAgICAgY29sbGlkZWRBZ2FpbnN0LnNldEFuZ3VsYXJWZWxvY2l0eShCQUJZTE9OLlZlY3RvcjMuWmVybygpKTtcclxuICAgIH1cclxuXHJcbiAgICBsaW1pdEJhbGxWZWxvY2l0eSgpIHtcclxuICAgICAgICBsZXQgdmVsb2NpdHkgPSB0aGlzLmJhbGwucGh5c2ljc0ltcG9zdG9yLmdldExpbmVhclZlbG9jaXR5KCk7XHJcblxyXG4gICAgICAgIGxldCB2ZWxvY2l0eVogPSB2ZWxvY2l0eS56O1xyXG4gICAgICAgIGxldCB2ZWxvY2l0eVpBYnMgPSBNYXRoLmFicyh2ZWxvY2l0eVopO1xyXG4gICAgICAgIGxldCBjbGFtcGVkVmVsb2NpdHlaID0gQkFCWUxPTi5NYXRoVG9vbHMuQ2xhbXAodmVsb2NpdHlaQWJzLCB0aGlzLm1pbkJhbGxTcGVlZCwgdGhpcy5tYXhCYWxsU3BlZWQpO1xyXG4gICAgICAgIGxldCBkaXJlY3Rpb24gPSBNYXRoLnNpZ24odmVsb2NpdHlaKTtcclxuXHJcbiAgICAgICAgbGV0IHZlbG9jaXR5WCA9IHZlbG9jaXR5Lng7XHJcbiAgICAgICAgbGV0IHZlbG9jaXR5WSA9IHZlbG9jaXR5Lnk7XHJcblxyXG4gICAgICAgIHRoaXMuYmFsbC5waHlzaWNzSW1wb3N0b3Iuc2V0TGluZWFyVmVsb2NpdHkoXHJcbiAgICAgICAgICAgIG5ldyBCQUJZTE9OLlZlY3RvcjMoXHJcbiAgICAgICAgICAgICAgICB2ZWxvY2l0eVgsXHJcbiAgICAgICAgICAgICAgICB2ZWxvY2l0eVksXHJcbiAgICAgICAgICAgICAgICBjbGFtcGVkVmVsb2NpdHlaICogZGlyZWN0aW9uXHJcbiAgICAgICAgICAgIClcclxuICAgICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIHVwZGF0ZShrZXlTdGF0ZXMsIHBsYXllclBhZGRsZVZlbG9jaXR5KSB7XHJcbiAgICAgICAgaWYgKHRoaXMuaXNMYXVuY2hlZCkge1xyXG4gICAgICAgICAgICB0aGlzLmxpbWl0QmFsbFZlbG9jaXR5KCk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5sb2NrUG9zaXRpb25Ub1BsYXllclBhZGRsZShwbGF5ZXJQYWRkbGVWZWxvY2l0eSk7XHJcbiAgICAgICAgICAgIHRoaXMubGF1bmNoQmFsbChrZXlTdGF0ZXMsIHBsYXllclBhZGRsZVZlbG9jaXR5KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcmVzZXRCYWxsU3RhdHMoKSB7XHJcbiAgICAgICAgdGhpcy5iYWxsLnBvc2l0aW9uID0gdGhpcy5pbml0aWFsUG9zaXRpb247XHJcbiAgICAgICAgdGhpcy5pc0xhdW5jaGVkID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5iYWxsLnBoeXNpY3NJbXBvc3Rvci5zZXRMaW5lYXJWZWxvY2l0eShCQUJZTE9OLlZlY3RvcjMuWmVybygpKTtcclxuICAgICAgICB0aGlzLmJhbGwucGh5c2ljc0ltcG9zdG9yLnNldEFuZ3VsYXJWZWxvY2l0eShCQUJZTE9OLlZlY3RvcjMuWmVybygpKTtcclxuICAgIH1cclxufVxuLy8vIDxyZWZlcmVuY2UgcGF0aD1cIi4vLi4vLi4vdHlwaW5ncy9iYWJ5bG9uLmQudHNcIiAvPlxyXG5cclxuY2xhc3MgUGFkZGxlIHtcclxuICAgIGNvbnN0cnVjdG9yKG5hbWUsIHNjZW5lLCBzcGF3blBvc2l0aW9uLCBwYWRkbGVJZCwgaXNBSSwgY29sb3IgPSAxKSB7XHJcbiAgICAgICAgdGhpcy5wYWRkbGUgPSBCQUJZTE9OLk1lc2hCdWlsZGVyLkNyZWF0ZUJveChgcGFkZGxlXyR7bmFtZX1gLCB7XHJcbiAgICAgICAgICAgIHdpZHRoOiA1LFxyXG4gICAgICAgICAgICBoZWlnaHQ6IDEsXHJcbiAgICAgICAgICAgIGRlcHRoOiAxXHJcbiAgICAgICAgfSwgc2NlbmUpO1xyXG4gICAgICAgIHRoaXMucGFkZGxlLnBvc2l0aW9uID0gc3Bhd25Qb3NpdGlvbjtcclxuICAgICAgICB0aGlzLnBhZGRsZS5waHlzaWNzSW1wb3N0b3IgPSBuZXcgQkFCWUxPTi5QaHlzaWNzSW1wb3N0b3IoXHJcbiAgICAgICAgICAgIHRoaXMucGFkZGxlLFxyXG4gICAgICAgICAgICBCQUJZTE9OLlBoeXNpY3NJbXBvc3Rvci5Cb3hJbXBvc3Rvciwge1xyXG4gICAgICAgICAgICAgICAgbWFzczogMSxcclxuICAgICAgICAgICAgICAgIGZyaWN0aW9uOiAwLFxyXG4gICAgICAgICAgICAgICAgcmVzdGl0dXRpb246IDBcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgc2NlbmVcclxuICAgICAgICApO1xyXG4gICAgICAgIHRoaXMucGFkZGxlLnBoeXNpY3NJbXBvc3Rvci5zZXRMaW5lYXJWZWxvY2l0eShCQUJZTE9OLlZlY3RvcjMuWmVybygpKTtcclxuICAgICAgICB0aGlzLnBhZGRsZS5waHlzaWNzSW1wb3N0b3IudW5pcXVlSWQgPSBwYWRkbGVJZDtcclxuXHJcbiAgICAgICAgdGhpcy5pbml0aWFsUG9zaXRpb24gPSBzcGF3blBvc2l0aW9uLmNsb25lKCk7XHJcbiAgICAgICAgdGhpcy5jb2xvciA9IGNvbG9yO1xyXG4gICAgICAgIHRoaXMubW92ZW1lbnRTcGVlZCA9IDU7XHJcblxyXG4gICAgICAgIHRoaXMuaXNBSSA9IGlzQUk7XHJcbiAgICB9XHJcblxyXG4gICAgbW92ZVBhZGRsZShrZXlTdGF0ZXMpIHtcclxuICAgICAgICBpZiAoa2V5U3RhdGVzWzM3XSkge1xyXG4gICAgICAgICAgICB0aGlzLnBhZGRsZS5waHlzaWNzSW1wb3N0b3Iuc2V0TGluZWFyVmVsb2NpdHkoQkFCWUxPTi5WZWN0b3IzLkxlZnQoKS5zY2FsZSh0aGlzLm1vdmVtZW50U3BlZWQpKTtcclxuICAgICAgICB9IGVsc2UgaWYgKGtleVN0YXRlc1szOV0pIHtcclxuICAgICAgICAgICAgdGhpcy5wYWRkbGUucGh5c2ljc0ltcG9zdG9yLnNldExpbmVhclZlbG9jaXR5KEJBQllMT04uVmVjdG9yMy5SaWdodCgpLnNjYWxlKHRoaXMubW92ZW1lbnRTcGVlZCkpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKCgha2V5U3RhdGVzWzM3XSAmJiAha2V5U3RhdGVzWzM5XSkgfHwgKGtleVN0YXRlc1szN10gJiYga2V5U3RhdGVzWzM5XSkpXHJcbiAgICAgICAgICAgIHRoaXMucGFkZGxlLnBoeXNpY3NJbXBvc3Rvci5zZXRMaW5lYXJWZWxvY2l0eShCQUJZTE9OLlZlY3RvcjMuWmVybygpKTtcclxuICAgIH1cclxuXHJcbiAgICBtb3ZlUGFkZGxlQUkoYmFsbE1lc2gpIHtcclxuICAgICAgICBsZXQgZGVzaXJlZERpcmVjdGlvbiA9IE1hdGguc2lnbihiYWxsTWVzaC5wb3NpdGlvbi54IC0gdGhpcy5wYWRkbGUucG9zaXRpb24ueCk7XHJcblxyXG4gICAgICAgIGlmIChkZXNpcmVkRGlyZWN0aW9uID09PSAtMSkge1xyXG4gICAgICAgICAgICB0aGlzLnBhZGRsZS5waHlzaWNzSW1wb3N0b3Iuc2V0TGluZWFyVmVsb2NpdHkoQkFCWUxPTi5WZWN0b3IzLkxlZnQoKS5zY2FsZSh0aGlzLm1vdmVtZW50U3BlZWQpKTtcclxuICAgICAgICB9IGVsc2UgaWYgKGRlc2lyZWREaXJlY3Rpb24gPT09IDEpIHtcclxuICAgICAgICAgICAgdGhpcy5wYWRkbGUucGh5c2ljc0ltcG9zdG9yLnNldExpbmVhclZlbG9jaXR5KEJBQllMT04uVmVjdG9yMy5SaWdodCgpLnNjYWxlKHRoaXMubW92ZW1lbnRTcGVlZCkpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMucGFkZGxlLnBoeXNpY3NJbXBvc3Rvci5zZXRMaW5lYXJWZWxvY2l0eShCQUJZTE9OLlZlY3RvcjMuWmVybygpKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgdXBkYXRlKGtleVN0YXRlcywgYmFsbCkge1xyXG4gICAgICAgIGlmICghdGhpcy5pc0FJKVxyXG4gICAgICAgICAgICB0aGlzLm1vdmVQYWRkbGUoa2V5U3RhdGVzKTtcclxuICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgIHRoaXMubW92ZVBhZGRsZUFJKGJhbGwpO1xyXG5cclxuICAgICAgICB0aGlzLnBhZGRsZS5waHlzaWNzSW1wb3N0b3Iuc2V0QW5ndWxhclZlbG9jaXR5KEJBQllMT04uVmVjdG9yMy5aZXJvKCkpO1xyXG4gICAgfVxyXG5cclxuICAgIHJlc2V0UGFkZGxlKCkge1xyXG4gICAgICAgIHRoaXMucGFkZGxlLnBvc2l0aW9uID0gdGhpcy5pbml0aWFsUG9zaXRpb247XHJcbiAgICAgICAgdGhpcy5wYWRkbGUucGh5c2ljc0ltcG9zdG9yLnNldExpbmVhclZlbG9jaXR5KEJBQllMT04uVmVjdG9yMy5aZXJvKCkpO1xyXG4gICAgICAgIHRoaXMucGFkZGxlLnBoeXNpY3NJbXBvc3Rvci5zZXRBbmd1bGFyVmVsb2NpdHkoQkFCWUxPTi5WZWN0b3IzLlplcm8oKSk7XHJcbiAgICB9XHJcbn1cbi8vLyA8cmVmZXJlbmNlIHBhdGg9XCIuLy4uLy4uL3R5cGluZ3MvYmFieWxvbi5kLnRzXCIgLz5cclxuLy8vIDxyZWZlcmVuY2UgcGF0aD1cIi4vcGFkZGxlLmpzXCIgLz5cclxuLy8vIDxyZWZlcmVuY2UgcGF0aD1cIi4vYmFsbC5qc1wiIC8+XHJcblxyXG4vLyBUb0RvOiBSZW1vdmUgYHNob3dCb3VuZGluZ0JveGAgZnJvbSBhbGwgYm9kaWVzXHJcblxyXG5jb25zdCBjYW52YXNIb2xkZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2FudmFzLWhvbGRlcicpO1xyXG5jb25zdCBjYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTtcclxuY2FudmFzLndpZHRoID0gd2luZG93LmlubmVyV2lkdGggLSAyNTtcclxuY2FudmFzLmhlaWdodCA9IHdpbmRvdy5pbm5lckhlaWdodCAtIDMwO1xyXG5jYW52YXNIb2xkZXIuYXBwZW5kQ2hpbGQoY2FudmFzKTtcclxuY29uc3QgZW5naW5lID0gbmV3IEJBQllMT04uRW5naW5lKGNhbnZhcywgdHJ1ZSk7XHJcblxyXG5jb25zdCBrZXlTdGF0ZXMgPSB7XHJcbiAgICAzMjogZmFsc2UsIC8vIFNQQUNFXHJcbiAgICAzNzogZmFsc2UsIC8vIExFRlRcclxuICAgIDM4OiBmYWxzZSwgLy8gVVBcclxuICAgIDM5OiBmYWxzZSwgLy8gUklHSFRcclxuICAgIDQwOiBmYWxzZSAvLyBET1dOXHJcbn07XHJcbndpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgKGV2ZW50KSA9PiB7XHJcbiAgICBpZiAoZXZlbnQua2V5Q29kZSBpbiBrZXlTdGF0ZXMpXHJcbiAgICAgICAga2V5U3RhdGVzW2V2ZW50LmtleUNvZGVdID0gdHJ1ZTtcclxufSk7XHJcbndpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdrZXl1cCcsIChldmVudCkgPT4ge1xyXG4gICAgaWYgKGV2ZW50LmtleUNvZGUgaW4ga2V5U3RhdGVzKVxyXG4gICAgICAgIGtleVN0YXRlc1tldmVudC5rZXlDb2RlXSA9IGZhbHNlO1xyXG59KTtcclxuXHJcbmNvbnN0IGNyZWF0ZVNjZW5lID0gKCkgPT4ge1xyXG4gICAgY29uc3Qgc2NlbmUgPSBuZXcgQkFCWUxPTi5TY2VuZShlbmdpbmUpO1xyXG4gICAgc2NlbmUuZW5hYmxlUGh5c2ljcyhuZXcgQkFCWUxPTi5WZWN0b3IzKDAsIC05LjgxLCAwKSwgbmV3IEJBQllMT04uQ2Fubm9uSlNQbHVnaW4oKSk7XHJcbiAgICBzY2VuZS5jb2xsaXNpb25zRW5hYmxlZCA9IHRydWU7XHJcbiAgICBzY2VuZS53b3JrZXJDb2xsaXNpb25zID0gdHJ1ZTtcclxuXHJcbiAgICBjb25zdCBjYW1lcmEgPSBuZXcgQkFCWUxPTi5GcmVlQ2FtZXJhKCdtYWluQ2FtZXJhJywgbmV3IEJBQllMT04uVmVjdG9yMygwLCAyMCwgLTYwKSwgc2NlbmUpO1xyXG4gICAgY2FtZXJhLnNldFRhcmdldChCQUJZTE9OLlZlY3RvcjMuWmVybygpKTtcclxuXHJcbiAgICBjb25zdCBsaWdodCA9IG5ldyBCQUJZTE9OLkhlbWlzcGhlcmljTGlnaHQoJ21haW5MaWdodCcsIG5ldyBCQUJZTE9OLlZlY3RvcjMoMCwgMSwgMCksIHNjZW5lKTtcclxuXHJcbiAgICBjb25zdCBncm91bmQgPSBCQUJZTE9OLk1lc2hCdWlsZGVyLkNyZWF0ZUdyb3VuZCgnbWFpbkdyb3VuZCcsIHtcclxuICAgICAgICB3aWR0aDogMzIsXHJcbiAgICAgICAgaGVpZ2h0OiA3MCxcclxuICAgICAgICBzdWJkaXZpc2lvbnM6IDJcclxuICAgIH0sIHNjZW5lKTtcclxuICAgIGdyb3VuZC5wb3NpdGlvbiA9IEJBQllMT04uVmVjdG9yMy5aZXJvKCk7XHJcbiAgICBncm91bmQucGh5c2ljc0ltcG9zdG9yID0gbmV3IEJBQllMT04uUGh5c2ljc0ltcG9zdG9yKFxyXG4gICAgICAgIGdyb3VuZCxcclxuICAgICAgICBCQUJZTE9OLlBoeXNpY3NJbXBvc3Rvci5Cb3hJbXBvc3Rvciwge1xyXG4gICAgICAgICAgICBtYXNzOiAwLFxyXG4gICAgICAgICAgICBmcmljdGlvbjogMCxcclxuICAgICAgICAgICAgcmVzdGl0dXRpb246IDBcclxuICAgICAgICB9LCBzY2VuZSk7XHJcblxyXG4gICAgY29uc3QgbGVmdEJhciA9IEJBQllMT04uTWVzaEJ1aWxkZXIuQ3JlYXRlQm94KCdsZWZ0QmFyJywge1xyXG4gICAgICAgIHdpZHRoOiAyLFxyXG4gICAgICAgIGhlaWdodDogMixcclxuICAgICAgICBkZXB0aDogNzBcclxuICAgIH0sIHNjZW5lKTtcclxuICAgIGxlZnRCYXIucG9zaXRpb24gPSBuZXcgQkFCWUxPTi5WZWN0b3IzKC0xNSwgMSwgMCk7XHJcbiAgICBsZWZ0QmFyLnBoeXNpY3NJbXBvc3RvciA9IG5ldyBCQUJZTE9OLlBoeXNpY3NJbXBvc3RvcihcclxuICAgICAgICBsZWZ0QmFyLFxyXG4gICAgICAgIEJBQllMT04uUGh5c2ljc0ltcG9zdG9yLkJveEltcG9zdG9yLCB7XHJcbiAgICAgICAgICAgIG1hc3M6IDAsXHJcbiAgICAgICAgICAgIGZyaWN0aW9uOiAwLFxyXG4gICAgICAgICAgICByZXN0aXR1dGlvbjogMVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgIGNvbnN0IHJpZ2h0QmFyID0gQkFCWUxPTi5NZXNoQnVpbGRlci5DcmVhdGVCb3goJ3JpZ2h0QmFyJywge1xyXG4gICAgICAgIHdpZHRoOiAyLFxyXG4gICAgICAgIGhlaWdodDogMixcclxuICAgICAgICBkZXB0aDogNzBcclxuICAgIH0sIHNjZW5lKTtcclxuICAgIHJpZ2h0QmFyLnBvc2l0aW9uID0gbmV3IEJBQllMT04uVmVjdG9yMygxNSwgMSwgMCk7XHJcbiAgICByaWdodEJhci5waHlzaWNzSW1wb3N0b3IgPSBuZXcgQkFCWUxPTi5QaHlzaWNzSW1wb3N0b3IoXHJcbiAgICAgICAgcmlnaHRCYXIsXHJcbiAgICAgICAgQkFCWUxPTi5QaHlzaWNzSW1wb3N0b3IuQm94SW1wb3N0b3IsIHtcclxuICAgICAgICAgICAgbWFzczogMCxcclxuICAgICAgICAgICAgZnJpY3Rpb246IDAsXHJcbiAgICAgICAgICAgIHJlc3RpdHV0aW9uOiAxXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgcmV0dXJuIHNjZW5lO1xyXG59O1xyXG5jb25zdCBzY2VuZSA9IGNyZWF0ZVNjZW5lKCk7XHJcbi8vIG5ldyBCQUJZTE9OLlZlY3RvcjMoMCwgMC41LCAtMzQpXHJcblxyXG5jb25zdCBwbGF5ZXJfMSA9IG5ldyBQYWRkbGUoJ3BsYXllcl8xJywgc2NlbmUsIG5ldyBCQUJZTE9OLlZlY3RvcjMoMCwgMC41LCAtMzQpLCAyLCBmYWxzZSk7XHJcbmNvbnN0IGFpUGxheWVyID0gbmV3IFBhZGRsZSgnYWlQbGF5ZXInLCBzY2VuZSwgbmV3IEJBQllMT04uVmVjdG9yMygwLCAwLjUsIDM0KSwgMywgdHJ1ZSk7XHJcblxyXG5jb25zdCBwbGF5aW5nQmFsbCA9IG5ldyBCYWxsKHNjZW5lLCBuZXcgQkFCWUxPTi5WZWN0b3IzKDAsIDAuNSwgLTMzKSwgMSk7XHJcbnBsYXlpbmdCYWxsLnNldENvbGxpc2lvbkNvbXBvbmVudHMoW3BsYXllcl8xLnBhZGRsZS5waHlzaWNzSW1wb3N0b3IsIGFpUGxheWVyLnBhZGRsZS5waHlzaWNzSW1wb3N0b3JdKTtcclxuXHJcbmNvbnN0IHNjb3JlQm9hcmQgPSBCQUJZTE9OLk1lc2hCdWlsZGVyLkNyZWF0ZVBsYW5lKCdzY29yZUJvYXJkJywge1xyXG4gICAgaGVpZ2h0OiAxNixcclxuICAgIHdpZHRoOiAzMixcclxuICAgIHNpZGVPcmllbnRhdGlvbjogQkFCWUxPTi5NZXNoLkRPVUJMRVNJREVcclxufSwgc2NlbmUpO1xyXG5zY29yZUJvYXJkLnBvc2l0aW9uID0gbmV3IEJBQllMT04uVmVjdG9yMygwLCAxNiwgMzYpO1xyXG5cclxuY29uc3QgYmFsbFJlc2V0Q29sbGlkZXIgPSBCQUJZTE9OLk1lc2hCdWlsZGVyLkNyZWF0ZUdyb3VuZCgnYmFsbENvbGxpZGVyJywge1xyXG4gICAgd2lkdGg6IDY0LFxyXG4gICAgaGVpZ2h0OiAxNDAsXHJcbiAgICBzdWJkaXZpc2lvbnM6IDJcclxufSwgc2NlbmUpO1xyXG5iYWxsUmVzZXRDb2xsaWRlci5wb3NpdGlvbiA9IG5ldyBCQUJZTE9OLlZlY3RvcjMoMCwgLTIsIDApO1xyXG5iYWxsUmVzZXRDb2xsaWRlci5waHlzaWNzSW1wb3N0b3IgPSBuZXcgQkFCWUxPTi5QaHlzaWNzSW1wb3N0b3IoXHJcbiAgICBiYWxsUmVzZXRDb2xsaWRlcixcclxuICAgIEJBQllMT04uUGh5c2ljc0ltcG9zdG9yLkJveEltcG9zdG9yLCB7XHJcbiAgICAgICAgbWFzczogMCxcclxuICAgICAgICBmcmljdGlvbjogMCxcclxuICAgICAgICByZXN0aXR1dGlvbjogMFxyXG4gICAgfVxyXG4pO1xyXG5iYWxsUmVzZXRDb2xsaWRlci5waHlzaWNzSW1wb3N0b3IucmVnaXN0ZXJPblBoeXNpY3NDb2xsaWRlKFxyXG4gICAgcGxheWluZ0JhbGwuYmFsbC5waHlzaWNzSW1wb3N0b3IsXHJcbiAgICAodGhpc0NvbGxpZGVySW1wb3N0ZXIsIGJhbGxJbXBvc3RlcikgPT4ge1xyXG5cclxuICAgIH0pO1xyXG5cclxuZW5naW5lLnJ1blJlbmRlckxvb3AoKCkgPT4ge1xyXG4gICAgcGxheWluZ0JhbGwudXBkYXRlKGtleVN0YXRlcywgcGxheWVyXzEucGFkZGxlLnBoeXNpY3NJbXBvc3Rvci5nZXRMaW5lYXJWZWxvY2l0eSgpKTtcclxuICAgIHBsYXllcl8xLnVwZGF0ZShrZXlTdGF0ZXMsIHBsYXlpbmdCYWxsLmJhbGwpO1xyXG4gICAgYWlQbGF5ZXIudXBkYXRlKGtleVN0YXRlcywgcGxheWluZ0JhbGwuYmFsbCk7XHJcblxyXG4gICAgYmFsbFJlc2V0Q29sbGlkZXIucGh5c2ljc0ltcG9zdG9yLnNldExpbmVhclZlbG9jaXR5KEJBQllMT04uVmVjdG9yMy5aZXJvKCkpO1xyXG4gICAgYmFsbFJlc2V0Q29sbGlkZXIucGh5c2ljc0ltcG9zdG9yLnNldEFuZ3VsYXJWZWxvY2l0eShCQUJZTE9OLlZlY3RvcjMuWmVybygpKTtcclxuXHJcbiAgICBzY2VuZS5yZW5kZXIoKTtcclxufSk7Il19
