'use strict';

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

/// <reference path="./../../typings/babylon.d.ts" />

var Ball = function Ball(scene, spawnPosition, color) {
    _classCallCheck(this, Ball);

    this.ball = BABYLON.MeshBuilder.CreateSphere('playBall', {
        segments: 16,
        diameter: 1
    }, scene);
    this.ball.physicsImpostor = new BABYLON.PhysicsImpostor(this.ball, BABYLON.PhysicsImpostor.SphereImpostor, {
        mass: 1,
        friction: 0,
        restitution: 1
    }, scene);
    this.ball.position = spawnPosition;
    this.ball.physicsImpostor.setLinearVelocity(BABYLON.Vector3.Zero());
    // this.ball.showBoundingBox = true;

    this.initialPosition = spawnPosition.clone();
    this.color = color;
};
/// <reference path="./../../typings/babylon.d.ts" />

var Paddle = function () {
    function Paddle(name, scene, spawnPosition, color) {
        _classCallCheck(this, Paddle);

        this.paddle = BABYLON.MeshBuilder.CreateBox('paddle' + name, {
            width: 5,
            height: 1,
            depth: 1
        }, scene);
        this.paddle.position = spawnPosition;
        this.paddle.physicsImpostor = new BABYLON.PhysicsImpostor(this.paddle, BABYLON.PhysicsImpostor.BoxImpostor, {
            mass: 1,
            friction: 0,
            restitution: 0
        }, scene);
        this.paddle.physicsImpostor.setLinearVelocity(BABYLON.Vector3.Zero());
        this.paddle.showBoundingBox = true;

        this.initialPosition = spawnPosition.clone();
        this.color = color;
        this.movementSpeed = 5;

        this.leftLimit = -14;
        this.rightLimit = 14;
    }

    _createClass(Paddle, [{
        key: 'movePaddle',
        value: function movePaddle(keyStates) {
            if (keyStates[37]) {
                this.paddle.physicsImpostor.setLinearVelocity(BABYLON.Vector3.Left().scale(this.movementSpeed));
            } else if (keyStates[39]) {
                this.paddle.physicsImpostor.setLinearVelocity(BABYLON.Vector3.Right().scale(this.movementSpeed));
            }

            if (!keyStates[37] && !keyStates[39] || keyStates[37] && keyStates[39]) this.paddle.physicsImpostor.setLinearVelocity(BABYLON.Vector3.Zero());

            this.paddle.physicsImpostor.setAngularVelocity(BABYLON.Vector3.Zero());
        }
    }, {
        key: 'update',
        value: function update(keyStates) {
            this.movePaddle(keyStates);
        }
    }]);

    return Paddle;
}();
/// <reference path="./../../typings/babylon.d.ts" />
/// <reference path="./paddle.js" />
/// <reference path="./ball.js" />

var canvasHolder = document.getElementById('canvas-holder');
var canvas = document.createElement('canvas');
canvas.width = window.innerWidth - 25;
canvas.height = window.innerHeight - 30;
canvasHolder.appendChild(canvas);
var engine = new BABYLON.Engine(canvas, true);

var fpsHolder = document.getElementById('fps-label');

var keyStates = {
    32: false, // SPACE
    37: false, // LEFT
    38: false, // TOP
    39: false, // RIGHT
    40: false // DOWN
};
window.addEventListener('keydown', function (event) {
    if (event.keyCode in keyStates) keyStates[event.keyCode] = true;
});
window.addEventListener('keyup', function (event) {
    if (event.keyCode in keyStates) keyStates[event.keyCode] = false;
});

var createScene = function createScene() {
    var scene = new BABYLON.Scene(engine);
    scene.enablePhysics(new BABYLON.Vector3(0, -9.81, 0), new BABYLON.CannonJSPlugin());
    scene.collisionsEnabled = true;
    scene.workerCollisions = true;

    var camera = new BABYLON.FreeCamera('mainCamera', new BABYLON.Vector3(0, 20, -60), scene);
    camera.setTarget(BABYLON.Vector3.Zero());

    var light = new BABYLON.HemisphericLight('mainLight', new BABYLON.Vector3(0, 1, 0), scene);

    var ground = BABYLON.MeshBuilder.CreateGround('mainGround', {
        width: 32,
        height: 70,
        subdivisions: 2
    }, scene);
    ground.position = BABYLON.Vector3.Zero();
    ground.physicsImpostor = new BABYLON.PhysicsImpostor(ground, BABYLON.PhysicsImpostor.BoxImpostor, {
        mass: 0,
        friction: 0,
        restitution: 0
    }, scene);

    var leftBar = BABYLON.MeshBuilder.CreateBox('leftBar', {
        width: 2,
        height: 2,
        depth: 70
    }, scene);
    leftBar.position = new BABYLON.Vector3(-15, 1, 0);
    leftBar.physicsImpostor = new BABYLON.PhysicsImpostor(leftBar, BABYLON.PhysicsImpostor.BoxImpostor, {
        mass: 0,
        friction: 0,
        restitution: 0
    });
    leftBar.showBoundingBox = true;

    var rightBar = BABYLON.MeshBuilder.CreateBox('rightBar', {
        width: 2,
        height: 2,
        depth: 70
    }, scene);
    rightBar.position = new BABYLON.Vector3(15, 1, 0);
    rightBar.physicsImpostor = new BABYLON.PhysicsImpostor(rightBar, BABYLON.PhysicsImpostor.BoxImpostor, {
        mass: 0,
        friction: 0,
        restitution: 0
    });
    rightBar.showBoundingBox = true;

    var testBlocker = BABYLON.MeshBuilder.CreateBox('testBlocker', {
        width: 30,
        height: 1,
        depth: 1
    }, scene);
    testBlocker.position = new BABYLON.Vector3(0, 0.5, 0);
    testBlocker.physicsImpostor = new BABYLON.PhysicsImpostor(testBlocker, BABYLON.PhysicsImpostor.BoxImpostor, {
        mass: 0,
        friction: 0,
        restitution: 1
    });
    testBlocker.showBoundingBox = true;

    return scene;
};
var scene = createScene();

var testPaddle = new Paddle('test', scene, new BABYLON.Vector3(0, 0.5, -34), 5);
var testBall = new Ball(scene, new BABYLON.Vector3(0, 5, 0), 4);

engine.runRenderLoop(function () {
    testPaddle.update(keyStates);
    scene.render();
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImJ1bmRsZS5qcyJdLCJuYW1lcyI6WyJCYWxsIiwic2NlbmUiLCJzcGF3blBvc2l0aW9uIiwiY29sb3IiLCJiYWxsIiwiQkFCWUxPTiIsIk1lc2hCdWlsZGVyIiwiQ3JlYXRlU3BoZXJlIiwic2VnbWVudHMiLCJkaWFtZXRlciIsInBoeXNpY3NJbXBvc3RvciIsIlBoeXNpY3NJbXBvc3RvciIsIlNwaGVyZUltcG9zdG9yIiwibWFzcyIsImZyaWN0aW9uIiwicmVzdGl0dXRpb24iLCJwb3NpdGlvbiIsInNldExpbmVhclZlbG9jaXR5IiwiVmVjdG9yMyIsIlplcm8iLCJpbml0aWFsUG9zaXRpb24iLCJjbG9uZSIsIlBhZGRsZSIsIm5hbWUiLCJwYWRkbGUiLCJDcmVhdGVCb3giLCJ3aWR0aCIsImhlaWdodCIsImRlcHRoIiwiQm94SW1wb3N0b3IiLCJzaG93Qm91bmRpbmdCb3giLCJtb3ZlbWVudFNwZWVkIiwibGVmdExpbWl0IiwicmlnaHRMaW1pdCIsImtleVN0YXRlcyIsIkxlZnQiLCJzY2FsZSIsIlJpZ2h0Iiwic2V0QW5ndWxhclZlbG9jaXR5IiwibW92ZVBhZGRsZSIsImNhbnZhc0hvbGRlciIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJjYW52YXMiLCJjcmVhdGVFbGVtZW50Iiwid2luZG93IiwiaW5uZXJXaWR0aCIsImlubmVySGVpZ2h0IiwiYXBwZW5kQ2hpbGQiLCJlbmdpbmUiLCJFbmdpbmUiLCJmcHNIb2xkZXIiLCJhZGRFdmVudExpc3RlbmVyIiwiZXZlbnQiLCJrZXlDb2RlIiwiY3JlYXRlU2NlbmUiLCJTY2VuZSIsImVuYWJsZVBoeXNpY3MiLCJDYW5ub25KU1BsdWdpbiIsImNvbGxpc2lvbnNFbmFibGVkIiwid29ya2VyQ29sbGlzaW9ucyIsImNhbWVyYSIsIkZyZWVDYW1lcmEiLCJzZXRUYXJnZXQiLCJsaWdodCIsIkhlbWlzcGhlcmljTGlnaHQiLCJncm91bmQiLCJDcmVhdGVHcm91bmQiLCJzdWJkaXZpc2lvbnMiLCJsZWZ0QmFyIiwicmlnaHRCYXIiLCJ0ZXN0QmxvY2tlciIsInRlc3RQYWRkbGUiLCJ0ZXN0QmFsbCIsInJ1blJlbmRlckxvb3AiLCJ1cGRhdGUiLCJyZW5kZXIiXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBOztJQUVNQSxJLEdBQ0YsY0FBWUMsS0FBWixFQUFtQkMsYUFBbkIsRUFBa0NDLEtBQWxDLEVBQXlDO0FBQUE7O0FBQ3JDLFNBQUtDLElBQUwsR0FBWUMsUUFBUUMsV0FBUixDQUFvQkMsWUFBcEIsQ0FBaUMsVUFBakMsRUFBNkM7QUFDckRDLGtCQUFVLEVBRDJDO0FBRXJEQyxrQkFBVTtBQUYyQyxLQUE3QyxFQUdUUixLQUhTLENBQVo7QUFJQSxTQUFLRyxJQUFMLENBQVVNLGVBQVYsR0FBNEIsSUFBSUwsUUFBUU0sZUFBWixDQUN4QixLQUFLUCxJQURtQixFQUV4QkMsUUFBUU0sZUFBUixDQUF3QkMsY0FGQSxFQUVnQjtBQUNwQ0MsY0FBTSxDQUQ4QjtBQUVwQ0Msa0JBQVUsQ0FGMEI7QUFHcENDLHFCQUFhO0FBSHVCLEtBRmhCLEVBT3hCZCxLQVB3QixDQUE1QjtBQVNBLFNBQUtHLElBQUwsQ0FBVVksUUFBVixHQUFxQmQsYUFBckI7QUFDQSxTQUFLRSxJQUFMLENBQVVNLGVBQVYsQ0FBMEJPLGlCQUExQixDQUE0Q1osUUFBUWEsT0FBUixDQUFnQkMsSUFBaEIsRUFBNUM7QUFDQTs7QUFFQSxTQUFLQyxlQUFMLEdBQXVCbEIsY0FBY21CLEtBQWQsRUFBdkI7QUFDQSxTQUFLbEIsS0FBTCxHQUFhQSxLQUFiO0FBQ0gsQztBQUVMOztJQUVNbUIsTTtBQUNGLG9CQUFZQyxJQUFaLEVBQWtCdEIsS0FBbEIsRUFBeUJDLGFBQXpCLEVBQXdDQyxLQUF4QyxFQUErQztBQUFBOztBQUMzQyxhQUFLcUIsTUFBTCxHQUFjbkIsUUFBUUMsV0FBUixDQUFvQm1CLFNBQXBCLFlBQXVDRixJQUF2QyxFQUErQztBQUN6REcsbUJBQU8sQ0FEa0Q7QUFFekRDLG9CQUFRLENBRmlEO0FBR3pEQyxtQkFBTztBQUhrRCxTQUEv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QUFxQixZQUFNO0FBQ3ZCRixlQUFXRyxNQUFYLENBQWtCekMsU0FBbEI7QUFDQWpDLFVBQU0yRSxNQUFOO0FBQ0gsQ0FIRCIsImZpbGUiOiJidW5kbGUuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLy8gPHJlZmVyZW5jZSBwYXRoPVwiLi8uLi8uLi90eXBpbmdzL2JhYnlsb24uZC50c1wiIC8+XHJcblxyXG5jbGFzcyBCYWxsIHtcclxuICAgIGNvbnN0cnVjdG9yKHNjZW5lLCBzcGF3blBvc2l0aW9uLCBjb2xvcikge1xyXG4gICAgICAgIHRoaXMuYmFsbCA9IEJBQllMT04uTWVzaEJ1aWxkZXIuQ3JlYXRlU3BoZXJlKCdwbGF5QmFsbCcsIHtcclxuICAgICAgICAgICAgc2VnbWVudHM6IDE2LFxyXG4gICAgICAgICAgICBkaWFtZXRlcjogMVxyXG4gICAgICAgIH0sIHNjZW5lKTtcclxuICAgICAgICB0aGlzLmJhbGwucGh5c2ljc0ltcG9zdG9yID0gbmV3IEJBQllMT04uUGh5c2ljc0ltcG9zdG9yKFxyXG4gICAgICAgICAgICB0aGlzLmJhbGwsXHJcbiAgICAgICAgICAgIEJBQllMT04uUGh5c2ljc0ltcG9zdG9yLlNwaGVyZUltcG9zdG9yLCB7XHJcbiAgICAgICAgICAgICAgICBtYXNzOiAxLFxyXG4gICAgICAgICAgICAgICAgZnJpY3Rpb246IDAsXHJcbiAgICAgICAgICAgICAgICByZXN0aXR1dGlvbjogMVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBzY2VuZVxyXG4gICAgICAgICk7XHJcbiAgICAgICAgdGhpcy5iYWxsLnBvc2l0aW9uID0gc3Bhd25Qb3NpdGlvbjtcclxuICAgICAgICB0aGlzLmJhbGwucGh5c2ljc0ltcG9zdG9yLnNldExpbmVhclZlbG9jaXR5KEJBQllMT04uVmVjdG9yMy5aZXJvKCkpO1xyXG4gICAgICAgIC8vIHRoaXMuYmFsbC5zaG93Qm91bmRpbmdCb3ggPSB0cnVlO1xyXG5cclxuICAgICAgICB0aGlzLmluaXRpYWxQb3NpdGlvbiA9IHNwYXduUG9zaXRpb24uY2xvbmUoKTtcclxuICAgICAgICB0aGlzLmNvbG9yID0gY29sb3I7XHJcbiAgICB9XHJcbn1cbi8vLyA8cmVmZXJlbmNlIHBhdGg9XCIuLy4uLy4uL3R5cGluZ3MvYmFieWxvbi5kLnRzXCIgLz5cclxuXHJcbmNsYXNzIFBhZGRsZSB7XHJcbiAgICBjb25zdHJ1Y3RvcihuYW1lLCBzY2VuZSwgc3Bhd25Qb3NpdGlvbiwgY29sb3IpIHtcclxuICAgICAgICB0aGlzLnBhZGRsZSA9IEJBQllMT04uTWVzaEJ1aWxkZXIuQ3JlYXRlQm94KGBwYWRkbGUke25hbWV9YCwge1xyXG4gICAgICAgICAgICB3aWR0aDogNSxcclxuICAgICAgICAgICAgaGVpZ2h0OiAxLFxyXG4gICAgICAgICAgICBkZXB0aDogMVxyXG4gICAgICAgIH0sIHNjZW5lKTtcclxuICAgICAgICB0aGlzLnBhZGRsZS5wb3NpdGlvbiA9IHNwYXduUG9zaXRpb247XHJcbiAgICAgICAgdGhpcy5wYWRkbGUucGh5c2ljc0ltcG9zdG9yID0gbmV3IEJBQllMT04uUGh5c2ljc0ltcG9zdG9yKFxyXG4gICAgICAgICAgICB0aGlzLnBhZGRsZSxcclxuICAgICAgICAgICAgQkFCWUxPTi5QaHlzaWNzSW1wb3N0b3IuQm94SW1wb3N0b3IsIHtcclxuICAgICAgICAgICAgICAgIG1hc3M6IDEsXHJcbiAgICAgICAgICAgICAgICBmcmljdGlvbjogMCxcclxuICAgICAgICAgICAgICAgIHJlc3RpdHV0aW9uOiAwXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHNjZW5lXHJcbiAgICAgICAgKTtcclxuICAgICAgICB0aGlzLnBhZGRsZS5waHlzaWNzSW1wb3N0b3Iuc2V0TGluZWFyVmVsb2NpdHkoQkFCWUxPTi5WZWN0b3IzLlplcm8oKSk7XHJcbiAgICAgICAgdGhpcy5wYWRkbGUuc2hvd0JvdW5kaW5nQm94ID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgdGhpcy5pbml0aWFsUG9zaXRpb24gPSBzcGF3blBvc2l0aW9uLmNsb25lKCk7XHJcbiAgICAgICAgdGhpcy5jb2xvciA9IGNvbG9yO1xyXG4gICAgICAgIHRoaXMubW92ZW1lbnRTcGVlZCA9IDU7XHJcblxyXG4gICAgICAgIHRoaXMubGVmdExpbWl0ID0gLTE0O1xyXG4gICAgICAgIHRoaXMucmlnaHRMaW1pdCA9IDE0O1xyXG4gICAgfVxyXG5cclxuICAgIG1vdmVQYWRkbGUoa2V5U3RhdGVzKSB7XHJcbiAgICAgICAgaWYgKGtleVN0YXRlc1szN10pIHtcclxuICAgICAgICAgICAgdGhpcy5wYWRkbGUucGh5c2ljc0ltcG9zdG9yLnNldExpbmVhclZlbG9jaXR5KEJBQllMT04uVmVjdG9yMy5MZWZ0KCkuc2NhbGUodGhpcy5tb3ZlbWVudFNwZWVkKSk7XHJcbiAgICAgICAgfSBlbHNlIGlmIChrZXlTdGF0ZXNbMzldKSB7XHJcbiAgICAgICAgICAgIHRoaXMucGFkZGxlLnBoeXNpY3NJbXBvc3Rvci5zZXRMaW5lYXJWZWxvY2l0eShCQUJZTE9OLlZlY3RvcjMuUmlnaHQoKS5zY2FsZSh0aGlzLm1vdmVtZW50U3BlZWQpKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICgoIWtleVN0YXRlc1szN10gJiYgIWtleVN0YXRlc1szOV0pIHx8IChrZXlTdGF0ZXNbMzddICYmIGtleVN0YXRlc1szOV0pKVxyXG4gICAgICAgICAgICB0aGlzLnBhZGRsZS5waHlzaWNzSW1wb3N0b3Iuc2V0TGluZWFyVmVsb2NpdHkoQkFCWUxPTi5WZWN0b3IzLlplcm8oKSk7XHJcblxyXG4gICAgICAgIHRoaXMucGFkZGxlLnBoeXNpY3NJbXBvc3Rvci5zZXRBbmd1bGFyVmVsb2NpdHkoQkFCWUxPTi5WZWN0b3IzLlplcm8oKSk7XHJcblxyXG4gICAgfVxyXG5cclxuICAgIHVwZGF0ZShrZXlTdGF0ZXMpIHtcclxuICAgICAgICB0aGlzLm1vdmVQYWRkbGUoa2V5U3RhdGVzKTtcclxuICAgIH1cclxufVxuLy8vIDxyZWZlcmVuY2UgcGF0aD1cIi4vLi4vLi4vdHlwaW5ncy9iYWJ5bG9uLmQudHNcIiAvPlxyXG4vLy8gPHJlZmVyZW5jZSBwYXRoPVwiLi9wYWRkbGUuanNcIiAvPlxyXG4vLy8gPHJlZmVyZW5jZSBwYXRoPVwiLi9iYWxsLmpzXCIgLz5cclxuXHJcbmNvbnN0IGNhbnZhc0hvbGRlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjYW52YXMtaG9sZGVyJyk7XHJcbmNvbnN0IGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpO1xyXG5jYW52YXMud2lkdGggPSB3aW5kb3cuaW5uZXJXaWR0aCAtIDI1O1xyXG5jYW52YXMuaGVpZ2h0ID0gd2luZG93LmlubmVySGVpZ2h0IC0gMzA7XHJcbmNhbnZhc0hvbGRlci5hcHBlbmRDaGlsZChjYW52YXMpO1xyXG5jb25zdCBlbmdpbmUgPSBuZXcgQkFCWUxPTi5FbmdpbmUoY2FudmFzLCB0cnVlKTtcclxuXHJcbmNvbnN0IGZwc0hvbGRlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmcHMtbGFiZWwnKTtcclxuXHJcbmNvbnN0IGtleVN0YXRlcyA9IHtcclxuICAgIDMyOiBmYWxzZSwgLy8gU1BBQ0VcclxuICAgIDM3OiBmYWxzZSwgLy8gTEVGVFxyXG4gICAgMzg6IGZhbHNlLCAvLyBUT1BcclxuICAgIDM5OiBmYWxzZSwgLy8gUklHSFRcclxuICAgIDQwOiBmYWxzZSAvLyBET1dOXHJcbn07XHJcbndpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgKGV2ZW50KSA9PiB7XHJcbiAgICBpZiAoZXZlbnQua2V5Q29kZSBpbiBrZXlTdGF0ZXMpXHJcbiAgICAgICAga2V5U3RhdGVzW2V2ZW50LmtleUNvZGVdID0gdHJ1ZTtcclxufSk7XHJcbndpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdrZXl1cCcsIChldmVudCkgPT4ge1xyXG4gICAgaWYgKGV2ZW50LmtleUNvZGUgaW4ga2V5U3RhdGVzKVxyXG4gICAgICAgIGtleVN0YXRlc1tldmVudC5rZXlDb2RlXSA9IGZhbHNlO1xyXG59KTtcclxuXHJcbmNvbnN0IGNyZWF0ZVNjZW5lID0gKCkgPT4ge1xyXG4gICAgY29uc3Qgc2NlbmUgPSBuZXcgQkFCWUxPTi5TY2VuZShlbmdpbmUpO1xyXG4gICAgc2NlbmUuZW5hYmxlUGh5c2ljcyhuZXcgQkFCWUxPTi5WZWN0b3IzKDAsIC05LjgxLCAwKSwgbmV3IEJBQllMT04uQ2Fubm9uSlNQbHVnaW4oKSk7XHJcbiAgICBzY2VuZS5jb2xsaXNpb25zRW5hYmxlZCA9IHRydWU7XHJcbiAgICBzY2VuZS53b3JrZXJDb2xsaXNpb25zID0gdHJ1ZTtcclxuXHJcbiAgICBjb25zdCBjYW1lcmEgPSBuZXcgQkFCWUxPTi5GcmVlQ2FtZXJhKCdtYWluQ2FtZXJhJywgbmV3IEJBQllMT04uVmVjdG9yMygwLCAyMCwgLTYwKSwgc2NlbmUpO1xyXG4gICAgY2FtZXJhLnNldFRhcmdldChCQUJZTE9OLlZlY3RvcjMuWmVybygpKTtcclxuXHJcbiAgICBjb25zdCBsaWdodCA9IG5ldyBCQUJZTE9OLkhlbWlzcGhlcmljTGlnaHQoJ21haW5MaWdodCcsIG5ldyBCQUJZTE9OLlZlY3RvcjMoMCwgMSwgMCksIHNjZW5lKTtcclxuXHJcbiAgICBjb25zdCBncm91bmQgPSBCQUJZTE9OLk1lc2hCdWlsZGVyLkNyZWF0ZUdyb3VuZCgnbWFpbkdyb3VuZCcsIHtcclxuICAgICAgICB3aWR0aDogMzIsXHJcbiAgICAgICAgaGVpZ2h0OiA3MCxcclxuICAgICAgICBzdWJkaXZpc2lvbnM6IDJcclxuICAgIH0sIHNjZW5lKTtcclxuICAgIGdyb3VuZC5wb3NpdGlvbiA9IEJBQllMT04uVmVjdG9yMy5aZXJvKCk7XHJcbiAgICBncm91bmQucGh5c2ljc0ltcG9zdG9yID0gbmV3IEJBQllMT04uUGh5c2ljc0ltcG9zdG9yKFxyXG4gICAgICAgIGdyb3VuZCxcclxuICAgICAgICBCQUJZTE9OLlBoeXNpY3NJbXBvc3Rvci5Cb3hJbXBvc3Rvciwge1xyXG4gICAgICAgICAgICBtYXNzOiAwLFxyXG4gICAgICAgICAgICBmcmljdGlvbjogMCxcclxuICAgICAgICAgICAgcmVzdGl0dXRpb246IDBcclxuICAgICAgICB9LCBzY2VuZSk7XHJcblxyXG4gICAgY29uc3QgbGVmdEJhciA9IEJBQllMT04uTWVzaEJ1aWxkZXIuQ3JlYXRlQm94KCdsZWZ0QmFyJywge1xyXG4gICAgICAgIHdpZHRoOiAyLFxyXG4gICAgICAgIGhlaWdodDogMixcclxuICAgICAgICBkZXB0aDogNzBcclxuICAgIH0sIHNjZW5lKTtcclxuICAgIGxlZnRCYXIucG9zaXRpb24gPSBuZXcgQkFCWUxPTi5WZWN0b3IzKC0xNSwgMSwgMCk7XHJcbiAgICBsZWZ0QmFyLnBoeXNpY3NJbXBvc3RvciA9IG5ldyBCQUJZTE9OLlBoeXNpY3NJbXBvc3RvcihcclxuICAgICAgICBsZWZ0QmFyLFxyXG4gICAgICAgIEJBQllMT04uUGh5c2ljc0ltcG9zdG9yLkJveEltcG9zdG9yLCB7XHJcbiAgICAgICAgICAgIG1hc3M6IDAsXHJcbiAgICAgICAgICAgIGZyaWN0aW9uOiAwLFxyXG4gICAgICAgICAgICByZXN0aXR1dGlvbjogMFxyXG4gICAgICAgIH0pO1xyXG4gICAgbGVmdEJhci5zaG93Qm91bmRpbmdCb3ggPSB0cnVlO1xyXG5cclxuICAgIGNvbnN0IHJpZ2h0QmFyID0gQkFCWUxPTi5NZXNoQnVpbGRlci5DcmVhdGVCb3goJ3JpZ2h0QmFyJywge1xyXG4gICAgICAgIHdpZHRoOiAyLFxyXG4gICAgICAgIGhlaWdodDogMixcclxuICAgICAgICBkZXB0aDogNzBcclxuICAgIH0sIHNjZW5lKTtcclxuICAgIHJpZ2h0QmFyLnBvc2l0aW9uID0gbmV3IEJBQllMT04uVmVjdG9yMygxNSwgMSwgMCk7XHJcbiAgICByaWdodEJhci5waHlzaWNzSW1wb3N0b3IgPSBuZXcgQkFCWUxPTi5QaHlzaWNzSW1wb3N0b3IoXHJcbiAgICAgICAgcmlnaHRCYXIsXHJcbiAgICAgICAgQkFCWUxPTi5QaHlzaWNzSW1wb3N0b3IuQm94SW1wb3N0b3IsIHtcclxuICAgICAgICAgICAgbWFzczogMCxcclxuICAgICAgICAgICAgZnJpY3Rpb246IDAsXHJcbiAgICAgICAgICAgIHJlc3RpdHV0aW9uOiAwXHJcbiAgICAgICAgfSk7XHJcbiAgICByaWdodEJhci5zaG93Qm91bmRpbmdCb3ggPSB0cnVlO1xyXG5cclxuICAgIGNvbnN0IHRlc3RCbG9ja2VyID0gQkFCWUxPTi5NZXNoQnVpbGRlci5DcmVhdGVCb3goJ3Rlc3RCbG9ja2VyJywge1xyXG4gICAgICAgIHdpZHRoOiAzMCxcclxuICAgICAgICBoZWlnaHQ6IDEsXHJcbiAgICAgICAgZGVwdGg6IDFcclxuICAgIH0sIHNjZW5lKTtcclxuICAgIHRlc3RCbG9ja2VyLnBvc2l0aW9uID0gbmV3IEJBQllMT04uVmVjdG9yMygwLCAwLjUsIDApO1xyXG4gICAgdGVzdEJsb2NrZXIucGh5c2ljc0ltcG9zdG9yID0gbmV3IEJBQllMT04uUGh5c2ljc0ltcG9zdG9yKFxyXG4gICAgICAgIHRlc3RCbG9ja2VyLFxyXG4gICAgICAgIEJBQllMT04uUGh5c2ljc0ltcG9zdG9yLkJveEltcG9zdG9yLCB7XHJcbiAgICAgICAgICAgIG1hc3M6IDAsXHJcbiAgICAgICAgICAgIGZyaWN0aW9uOiAwLFxyXG4gICAgICAgICAgICByZXN0aXR1dGlvbjogMVxyXG4gICAgICAgIH0pO1xyXG4gICAgdGVzdEJsb2NrZXIuc2hvd0JvdW5kaW5nQm94ID0gdHJ1ZTtcclxuXHJcbiAgICByZXR1cm4gc2NlbmU7XHJcbn07XHJcbmNvbnN0IHNjZW5lID0gY3JlYXRlU2NlbmUoKTtcclxuXHJcbmNvbnN0IHRlc3RQYWRkbGUgPSBuZXcgUGFkZGxlKCd0ZXN0Jywgc2NlbmUsIG5ldyBCQUJZTE9OLlZlY3RvcjMoMCwgMC41LCAtMzQpLCA1KTtcclxuY29uc3QgdGVzdEJhbGwgPSBuZXcgQmFsbChzY2VuZSwgbmV3IEJBQllMT04uVmVjdG9yMygwLCA1LCAwKSwgNCk7XHJcblxyXG5lbmdpbmUucnVuUmVuZGVyTG9vcCgoKSA9PiB7XHJcbiAgICB0ZXN0UGFkZGxlLnVwZGF0ZShrZXlTdGF0ZXMpO1xyXG4gICAgc2NlbmUucmVuZGVyKCk7XHJcbn0pOyJdfQ==
