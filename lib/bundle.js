var Player = (function () {
    function Player(scene, ground) {
        var _this = this;
        this.jumpVelocity = 10;
        this.hitDistance = 0.7;
        this.fallMultiplier = 2.5;
        this.lowJumpMultiplier = 2;
        this.sideLength = 1;
        this.requiredKeys = {
            32: false,
            37: false,
            38: false,
            39: false,
            40: false
        };
        this.scene = scene;
        this.ground = ground;
        this.playerShape = BABYLON.MeshBuilder.CreateBox('player', {
            width: 1,
            height: 1,
            depth: 1
        }, this.scene);
        this.playerShape.position = new BABYLON.Vector3(0, 5, 0);
        this.playerShape.checkCollisions = true;
        this.playerShape.physicsImpostor = new BABYLON.PhysicsImpostor(this.playerShape, BABYLON.PhysicsImpostor.BoxImpostor, { mass: 1 }, this.scene);
        this.playerShape.physicsImpostor.setLinearVelocity(BABYLON.Vector3.Zero());
        window.addEventListener('keydown', function (event) {
            _this.handleKeyDown(event);
        });
        window.addEventListener('keyup', function (event) {
            _this.handleKeyUp(event);
        });
    }
    Player.prototype.handleKeyDown = function (event) {
        var key = event.keyCode;
        if (key in this.requiredKeys) {
            this.requiredKeys[key] = true;
        }
    };
    Player.prototype.handleKeyUp = function (event) {
        var key = event.keyCode;
        if (key in this.requiredKeys) {
            this.requiredKeys[key] = false;
        }
    };
    Player.prototype.vecToLocal = function (vector, mesh) {
        var m = mesh.getWorldMatrix();
        var v = BABYLON.Vector3.TransformCoordinates(vector, m);
        return v;
    };
    Player.prototype.basicJump = function () {
        var ray = new BABYLON.Ray(this.playerShape.position, BABYLON.Vector3.Up().negate(), 10);
        var hit = ray.intersectsMeshes([ground], true);
        if (hit.length)
            if (hit[0].distance <= this.hitDistance && this.requiredKeys[32]) {
                var zVelocity = this.playerShape.physicsImpostor.getLinearVelocity().z;
                this.playerShape.physicsImpostor.setLinearVelocity(new BABYLON.Vector3(0, this.jumpVelocity, zVelocity));
                this.requiredKeys[32] = false;
            }
    };
    Player.prototype.update = function () {
        this.basicJump();
    };
    return Player;
}());
var canvasHolder = document.getElementById('canvas-holder');
var canvas = document.createElement('canvas');
canvas.width = window.innerWidth - 25;
canvas.height = window.innerHeight - 25;
canvasHolder.appendChild(canvas);
var fpsLabel = document.getElementById('fpsLabel');
var engine = new BABYLON.Engine(canvas, true);
var scene = new BABYLON.Scene(engine);
scene.collisionsEnabled = true;
scene.workerCollisions = true;
scene.enablePhysics(new BABYLON.Vector3(0, -9.81, 0), new BABYLON.CannonJSPlugin());
var camera = new BABYLON.FreeCamera("mainCamera", new BABYLON.Vector3(0, 5, -10), scene);
camera.setTarget(BABYLON.Vector3.Zero());
camera.attachControl(canvas, false);
var light = new BABYLON.HemisphericLight("pointLight", new BABYLON.Vector3(5, 7, 5), scene);
light.intensity = 0.7;
var ground = BABYLON.MeshBuilder.CreateGround('ground', {
    width: 10, height: 10, subdivisions: 2
}, scene);
ground.position = BABYLON.Vector3.Zero();
ground.physicsImpostor = new BABYLON.PhysicsImpostor(ground, BABYLON.PhysicsImpostor.BoxImpostor, { mass: 0, restitution: 0.9 }, scene);
ground.isPickable = true;
var player = new Player(scene, ground);
scene.registerBeforeRender(function () {
    player.update();
});
engine.runRenderLoop(function () {
    scene.render();
    fpsLabel.innerHTML = engine.getFps().toFixed() + " fps";
});

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9NYXJpby9wbGF5ZXIudHMiLCJzcmMvTWFyaW8vaW5kZXgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBR0E7SUF5QkksZ0JBQVksS0FBb0IsRUFBRSxNQUFvQjtRQUF0RCxpQkF1QkM7UUF0Q0QsaUJBQVksR0FBVyxFQUFFLENBQUM7UUFDMUIsZ0JBQVcsR0FBVyxHQUFHLENBQUM7UUFDMUIsbUJBQWMsR0FBVyxHQUFHLENBQUM7UUFDN0Isc0JBQWlCLEdBQVcsQ0FBQyxDQUFDO1FBRTlCLGVBQVUsR0FBVyxDQUFDLENBQUM7UUFFdkIsaUJBQVksR0FBRztZQUNYLEVBQUUsRUFBRSxLQUFLO1lBQ1QsRUFBRSxFQUFFLEtBQUs7WUFDVCxFQUFFLEVBQUUsS0FBSztZQUNULEVBQUUsRUFBRSxLQUFLO1lBQ1QsRUFBRSxFQUFFLEtBQUs7U0FDWixDQUFBO1FBR0csSUFBSSxDQUFDLEtBQUssR0FBRyxLQUFLLENBQUM7UUFDbkIsSUFBSSxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUM7UUFFckIsSUFBSSxDQUFDLFdBQVcsR0FBRyxPQUFPLENBQUMsV0FBVyxDQUFDLFNBQVMsQ0FBQyxRQUFRLEVBQUU7WUFDdkQsS0FBSyxFQUFFLENBQUM7WUFDUixNQUFNLEVBQUUsQ0FBQztZQUNULEtBQUssRUFBRSxDQUFDO1NBQ1gsRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDZixJQUFJLENBQUMsV0FBVyxDQUFDLFFBQVEsR0FBRyxJQUFJLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztRQUN6RCxJQUFJLENBQUMsV0FBVyxDQUFDLGVBQWUsR0FBRyxJQUFJLENBQUM7UUFDeEMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxlQUFlLEdBQUcsSUFBSSxPQUFPLENBQUMsZUFBZSxDQUMxRCxJQUFJLENBQUMsV0FBVyxFQUFFLE9BQU8sQ0FBQyxlQUFlLENBQUMsV0FBVyxFQUFFLEVBQUUsSUFBSSxFQUFF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TyxDQUFDLE9BQU8sQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLEtBQUssQ0FBQyxDQUFDO0FBQzlGLEtBQUssQ0FBQyxTQUFTLEdBQUcsR0FBRyxDQUFDO0FBRXRCLElBQU0sTUFBTSxHQUFHLE9BQU8sQ0FBQyxXQUFXLENBQUMsWUFBWSxDQUFDLFFBQVEsRUFBRTtJQUN0RCxLQUFLLEVBQUUsRUFBRSxFQUFFLE1BQU0sRUFBRSxFQUFFLEVBQUUsWUFBWSxFQUFFLENBQUM7Q0FDekMsRUFBRSxLQUFLLENBQUMsQ0FBQztBQUNWLE1BQU0sQ0FBQyxRQUFRLEdBQUcsT0FBTyxDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUUsQ0FBQztBQUN6QyxNQUFNLENBQUMsZUFBZSxHQUFHLElBQUksT0FBTyxDQUFDLGVBQWUsQ0FBQyxNQUFNLEVBQUUsT0FBTyxDQUFDLGVBQWUsQ0FBQyxXQUFXLEVBQUUsRUFBRSxJQUFJLEVBQUUsQ0FBQyxFQUFFLFdBQVcsRUFBRSxHQUFHLEVBQUUsRUFBRSxLQUFLLENBQUMsQ0FBQztBQUN4SSxNQUFNLENBQUMsVUFBVSxHQUFHLElBQUksQ0FBQztBQUV6QixJQUFNLE1BQU0sR0FBRyxJQUFJLE1BQU0sQ0FBQyxLQUFLLEVBQUUsTUFBTSxDQUFDLENBQUM7QUFDekMsS0FBSyxDQUFDLG9CQUFvQixDQUFDO0lBQ3ZCLE1BQU0sQ0FBQyxNQUFNLEVBQUUsQ0FBQztBQUNwQixDQUFDLENBQUMsQ0FBQztBQUVILE1BQU0sQ0FBQyxhQUFhLENBQUM7SUFDakIsS0FBSyxDQUFDLE1BQU0sRUFBRSxDQUFDO0lBQ2YsUUFBUSxDQUFDLFNBQVMsR0FBRyxNQUFNLENBQUMsTUFBTSxFQUFFLENBQUMsT0FBTyxFQUFFLEdBQUcsTUFBTSxDQUFDO0FBQzVELENBQUMsQ0FBQyxDQUFDIiwiZmlsZSI6ImJ1bmRsZS5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vLyA8cmVmZXJlbmNlIHBhdGg9XCIuLy4uLy4uL3R5cGluZ3MvYmFieWxvbi5kLnRzXCIgLz5cclxuXHJcblxyXG5jbGFzcyBQbGF5ZXIge1xyXG4gICAgdmVsb2NpdHk6IEJBQllMT04uVmVjdG9yMztcclxuXHJcbiAgICBwbGF5ZXJTaGFwZTogQkFCWUxPTi5NZXNoO1xyXG4gICAgcmF5OiBCQUJZTE9OLlJheTtcclxuICAgIHJheUhlbHBlcjogQkFCWUxPTi5SYXlIZWxwZXI7XHJcblxyXG4gICAgc2NlbmU6IEJBQllMT04uU2NlbmU7XHJcbiAgICBncm91bmQ6IEJBQllMT04uTWVzaDtcclxuXHJcbiAgICBqdW1wVmVsb2NpdHk6IG51bWJlciA9IDEwO1xyXG4gICAgaGl0RGlzdGFuY2U6IG51bWJlciA9IDAuNztcclxuICAgIGZhbGxNdWx0aXBsaWVyOiBudW1iZXIgPSAyLjU7XHJcbiAgICBsb3dKdW1wTXVsdGlwbGllcjogbnVtYmVyID0gMjtcclxuXHJcbiAgICBzaWRlTGVuZ3RoOiBudW1iZXIgPSAxO1xyXG5cclxuICAgIHJlcXVpcmVkS2V5cyA9IHtcclxuICAgICAgICAzMjogZmFsc2UsIC8vIFNQQUNFXHJcbiAgICAgICAgMzc6IGZhbHNlLCAvLyBMRUZUXHJcbiAgICAgICAgMzg6IGZhbHNlLCAvLyBUT1BcclxuICAgICAgICAzOTogZmFsc2UsIC8vIFJJR0hUXHJcbiAgICAgICAgNDA6IGZhbHNlIC8vIERPV05cclxuICAgIH1cclxuXHJcbiAgICBjb25zdHJ1Y3RvcihzY2VuZTogQkFCWUxPTi5TY2VuZSwgZ3JvdW5kOiBCQUJZTE9OLk1lc2gpIHtcclxuICAgICAgICB0aGlzLnNjZW5lID0gc2NlbmU7XHJcbiAgICAgICAgdGhpcy5ncm91bmQgPSBncm91bmQ7XHJcblxyXG4gICAgICAgIHRoaXMucGxheWVyU2hhcGUgPSBCQUJZTE9OLk1lc2hCdWlsZGVyLkNyZWF0ZUJveCgncGxheWVyJywge1xyXG4gICAgICAgICAgICB3aWR0aDogMSxcclxuICAgICAgICAgICAgaGVpZ2h0OiAxLFxyXG4gICAgICAgICAgICBkZXB0aDogMVxyXG4gICAgICAgIH0sIHRoaXMuc2NlbmUpO1xyXG4gICAgICAgIHRoaXMucGxheWVyU2hhcGUucG9zaXRpb24gPSBuZXcgQkFCWUxPTi5WZWN0b3IzKDAsIDUsIDApO1xyXG4gICAgICAgIHRoaXMucGxheWVyU2hhcGUuY2hlY2tDb2xsaXNpb25zID0gdHJ1ZTtcclxuICAgICAgICB0aGlzLnBsYXllclNoYXBlLnBoeXNpY3NJbXBvc3RvciA9IG5ldyBCQUJZTE9OLlBoeXNpY3NJbXBvc3RvcihcclxuICAgICAgICAgICAgdGhpcy5wbGF5ZXJTaGFwZSwgQkFCWUxPTi5QaHlzaWNzSW1wb3N0b3IuQm94SW1wb3N0b3IsIHsgbWFzczogMSB9LFxyXG4gICAgICAgICAgICB0aGlzLnNjZW5lXHJcbiAgICAgICAgKTtcclxuICAgICAgICB0aGlzLnBsYXllclNoYXBlLnBoeXNpY3NJbXBvc3Rvci5zZXRMaW5lYXJWZWxvY2l0eShCQUJZTE9OLlZlY3RvcjMuWmVybygpKTtcclxuXHJcbiAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCBldmVudCA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuaGFuZGxlS2V5RG93bihldmVudCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2tleXVwJywgZXZlbnQgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLmhhbmRsZUtleVVwKGV2ZW50KTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGhhbmRsZUtleURvd24oZXZlbnQ6IEtleWJvYXJkRXZlbnQpIHtcclxuICAgICAgICBsZXQga2V5ID0gZXZlbnQua2V5Q29kZTtcclxuICAgICAgICBpZiAoa2V5IGluIHRoaXMucmVxdWlyZWRLZXlzKSB7XHJcbiAgICAgICAgICAgIHRoaXMucmVxdWlyZWRLZXlzW2tleV0gPSB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGhhbmRsZUtleVVwKGV2ZW50OiBLZXlib2FyZEV2ZW50KSB7XHJcbiAgICAgICAgbGV0IGtleSA9IGV2ZW50LmtleUNvZGU7XHJcbiAgICAgICAgaWYgKGtleSBpbiB0aGlzLnJlcXVpcmVkS2V5cykge1xyXG4gICAgICAgICAgICB0aGlzLnJlcXVpcmVkS2V5c1trZXldID0gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgdmVjVG9Mb2NhbCh2ZWN0b3I6IEJBQllMT04uVmVjdG9yMywgbWVzaDogQkFCWUxPTi5NZXNoKTogQkFCWUxPTi5WZWN0b3IzIHtcclxuICAgICAgICBsZXQgbSA9IG1lc2guZ2V0V29ybGRNYXRyaXgoKTtcclxuICAgICAgICBsZXQgdiA9IEJBQllMT04uVmVjdG9yMy5UcmFuc2Zvcm1Db29yZGluYXRlcyh2ZWN0b3IsIG0pO1xyXG4gICAgICAgIHJldHVybiB2O1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgYmFzaWNKdW1wKCkge1xyXG4gICAgICAgIGxldCByYXkgPSBuZXcgQkFCWUxPTi5SYXkodGhpcy5wbGF5ZXJTaGFwZS5wb3NpdGlvbiwgQkFCWUxPTi5WZWN0b3IzLlVwKCkubmVnYXRlKCksIDEwKTtcclxuICAgICAgICBsZXQgaGl0ID0gcmF5LmludGVyc2VjdHNNZXNoZXMoW2dyb3VuZF0sIHRydWUpO1xyXG5cclxuICAgICAgICBpZiAoaGl0Lmxlbmd0aClcclxuICAgICAgICAgICAgaWYgKGhpdFswXS5kaXN0YW5jZSA8PSB0aGlzLmhpdERpc3RhbmNlICYmIHRoaXMucmVxdWlyZWRLZXlzWzMyXSkge1xyXG4gICAgICAgICAgICAgICAgbGV0IHpWZWxvY2l0eSA9IHRoaXMucGxheWVyU2hhcGUucGh5c2ljc0ltcG9zdG9yLmdldExpbmVhclZlbG9jaXR5KCkuejtcclxuICAgICAgICAgICAgICAgIHRoaXMucGxheWVyU2hhcGUucGh5c2ljc0ltcG9zdG9yLnNldExpbmVhclZlbG9jaXR5KG5ldyBCQUJZTE9OLlZlY3RvcjMoMCwgdGhpcy5qdW1wVmVsb2NpdHksIHpWZWxvY2l0eSkpO1xyXG5cclxuICAgICAgICAgICAgICAgIHRoaXMucmVxdWlyZWRLZXlzWzMyXSA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgdXBkYXRlKCkge1xyXG4gICAgICAgIHRoaXMuYmFzaWNKdW1wKCk7XHJcbiAgICB9XHJcbn0iLCIvLy8gPHJlZmVyZW5jZSBwYXRoPVwiLi8uLi8uLi90eXBpbmdzL2JhYnlsb24uZC50c1wiIC8+XHJcbi8vLyA8cmVmZXJlbmNlIHBhdGg9XCIuL3BsYXllci50c1wiIC8+XHJcblxyXG5jb25zdCBjYW52YXNIb2xkZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2FudmFzLWhvbGRlcicpO1xyXG5jb25zdCBjYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTtcclxuY2FudmFzLndpZHRoID0gd2luZG93LmlubmVyV2lkdGggLSAyNTtcclxuY2FudmFzLmhlaWdodCA9IHdpbmRvdy5pbm5lckhlaWdodCAtIDI1O1xyXG5jYW52YXNIb2xkZXIuYXBwZW5kQ2hpbGQoY2FudmFzKTtcclxuXHJcbmNvbnN0IGZwc0xhYmVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Zwc0xhYmVsJyk7XHJcblxyXG5jb25zdCBlbmdpbmU6IEJBQllMT04uRW5naW5lID0gbmV3IEJBQllMT04uRW5naW5lKGNhbnZhcywgdHJ1ZSk7XHJcblxyXG5jb25zdCBzY2VuZSA9IG5ldyBCQUJZTE9OLlNjZW5lKGVuZ2luZSk7XHJcbnNjZW5lLmNvbGxpc2lvbnNFbmFibGVkID0gdHJ1ZTtcclxuc2NlbmUud29ya2VyQ29sbGlzaW9ucyA9IHRydWU7XHJcbnNjZW5lLmVuYWJsZVBoeXNpY3MobmV3IEJBQllMT04uVmVjdG9yMygwLCAtOS44MSwgMCksIG5ldyBCQUJZTE9OLkNhbm5vbkpTUGx1Z2luKCkpO1xyXG5cclxuY29uc3QgY2FtZXJhID0gbmV3IEJBQllMT04uRnJlZUNhbWVyYShcIm1haW5DYW1lcmFcIiwgbmV3IEJBQllMT04uVmVjdG9yMygwLCA1LCAtMTApLCBzY2VuZSk7XHJcbmNhbWVyYS5zZXRUYXJnZXQoQkFCWUxPTi5WZWN0b3IzLlplcm8oKSk7XHJcbmNhbWVyYS5hdHRhY2hDb250cm9sKGNhbnZhcywgZmFsc2UpO1xyXG5cclxuY29uc3QgbGlnaHQgPSBuZXcgQkFCWUxPTi5IZW1pc3BoZXJpY0xpZ2h0KFwicG9pbnRMaWdodFwiLCBuZXcgQkFCWUxPTi5WZWN0b3IzKDUsIDcsIDUpLCBzY2VuZSk7XHJcbmxpZ2h0LmludGVuc2l0eSA9IDAuNztcclxuXHJcbmNvbnN0IGdyb3VuZCA9IEJBQllMT04uTWVzaEJ1aWxkZXIuQ3JlYXRlR3JvdW5kKCdncm91bmQnLCB7XHJcbiAgICB3aWR0aDogMTAsIGhlaWdodDogMTAsIHN1YmRpdmlzaW9uczogMlxyXG59LCBzY2VuZSk7XHJcbmdyb3VuZC5wb3NpdGlvbiA9IEJBQllMT04uVmVjdG9yMy5aZXJvKCk7XHJcbmdyb3VuZC5waHlzaWNzSW1wb3N0b3IgPSBuZXcgQkFCWUxPTi5QaHlzaWNzSW1wb3N0b3IoZ3JvdW5kLCBCQUJZTE9OLlBoeXNpY3NJbXBvc3Rvci5Cb3hJbXBvc3RvciwgeyBtYXNzOiAwLCByZXN0aXR1dGlvbjogMC45IH0sIHNjZW5lKTtcclxuZ3JvdW5kLmlzUGlja2FibGUgPSB0cnVlO1xyXG5cclxuY29uc3QgcGxheWVyID0gbmV3IFBsYXllcihzY2VuZSwgZ3JvdW5kKTtcclxuc2NlbmUucmVnaXN0ZXJCZWZvcmVSZW5kZXIoKCkgPT4ge1xyXG4gICAgcGxheWVyLnVwZGF0ZSgpO1xyXG59KTtcclxuXHJcbmVuZ2luZS5ydW5SZW5kZXJMb29wKCgpID0+IHtcclxuICAgIHNjZW5lLnJlbmRlcigpO1xyXG4gICAgZnBzTGFiZWwuaW5uZXJIVE1MID0gZW5naW5lLmdldEZwcygpLnRvRml4ZWQoKSArIFwiIGZwc1wiO1xyXG59KTsiXX0=
