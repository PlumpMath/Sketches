'use strict';

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

/// <reference path="./../../typings/babylon.d.ts" />

var Ball = function () {
    function Ball(scene, spawnPosition, ballId) {
        var color = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 1;

        _classCallCheck(this, Ball);

        this.minBallSpeed = 5;
        this.maxBallSpeed = 20;

        this.ball = BABYLON.MeshBuilder.CreateSphere('playBall', {
            segments: 16,
            diameter: 1
        }, scene);
        this.ball.physicsImpostor = new BABYLON.PhysicsImpostor(this.ball, BABYLON.PhysicsImpostor.SphereImpostor, {
            mass: 1,
            friction: 0,
            restitution: 1
        }, scene);
        this.ball.position = spawnPosition;
        this.ball.physicsImpostor.uniqueId = ballId;

        this.initialPosition = spawnPosition.clone();
        this.isLaunched = false;
        this.color = color;
    }

    _createClass(Ball, [{
        key: 'lockPositionToPlayerPaddle',
        value: function lockPositionToPlayerPaddle(playerPaddle, playerMovementSpeed) {}
    }, {
        key: 'setCollisionComponents',
        value: function setCollisionComponents(imposters) {
            this.ball.physicsImpostor.registerOnPhysicsCollide(imposters, this.onTriggerEnter);
        }
    }, {
        key: 'onTriggerEnter',
        value: function onTriggerEnter(ball, collidedAgainst) {
            var velocityX = collidedAgainst.getLinearVelocity().x;
            var velocityXBall = ball.getLinearVelocity().x;
            var velocityZ = -ball.getLinearVelocity().z;

            ball.setLinearVelocity(new BABYLON.Vector3(velocityX - velocityXBall, 0, velocityZ));

            collidedAgainst.setAngularVelocity(BABYLON.Vector3.Zero());
        }
    }, {
        key: 'update',
        value: function update() {
            var velocityZ = this.ball.physicsImpostor.getLinearVelocity().z;
            var velocityZAbs = Math.abs(velocityZ);
            var clampedVelocityZ = BABYLON.MathTools.Clamp(velocityZAbs, this.minBallSpeed, this.maxBallSpeed);
            var direction = Math.sign(velocityZ);

            var velocityX = this.ball.physicsImpostor.getLinearVelocity().x;

            this.ball.physicsImpostor.setLinearVelocity(new BABYLON.Vector3(velocityX, 0, clampedVelocityZ * direction));
        }
    }]);

    return Ball;
}();
/// <reference path="./../../typings/babylon.d.ts" />

var Paddle = function () {
    function Paddle(name, scene, spawnPosition, paddleId, isAI) {
        var color = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : 1;

        _classCallCheck(this, Paddle);

        this.paddle = BABYLON.MeshBuilder.CreateBox('paddle' + name, {
            width: 5,
            height: 1,
            depth: 1
        }, scene);
        this.paddle.position = spawnPosition;
        this.paddle.physicsImpostor = new BABYLON.PhysicsImpostor(this.paddle, BABYLON.PhysicsImpostor.BoxImpostor, {
            mass: 1,
            friction: 0,
            restitution: 0
        }, scene);
        this.paddle.physicsImpostor.setLinearVelocity(BABYLON.Vector3.Zero());
        this.paddle.physicsImpostor.uniqueId = paddleId;

        this.initialPosition = spawnPosition.clone();
        this.color = color;
        this.movementSpeed = 5;

        this.isAI = isAI;
    }

    _createClass(Paddle, [{
        key: 'movePaddle',
        value: function movePaddle(keyStates) {
            if (keyStates[37]) {
                this.paddle.physicsImpostor.setLinearVelocity(BABYLON.Vector3.Left().scale(this.movementSpeed));
            } else if (keyStates[39]) {
                this.paddle.physicsImpostor.setLinearVelocity(BABYLON.Vector3.Right().scale(this.movementSpeed));
            }

            if (!keyStates[37] && !keyStates[39] || keyStates[37] && keyStates[39]) this.paddle.physicsImpostor.setLinearVelocity(BABYLON.Vector3.Zero());
        }
    }, {
        key: 'movePaddleAI',
        value: function movePaddleAI(ball) {
            var desiredDirection = Math.sign(ball.position.x - this.paddle.position.x);

            if (desiredDirection === -1) {
                this.paddle.physicsImpostor.setLinearVelocity(BABYLON.Vector3.Left().scale(this.movementSpeed));
            } else if (desiredDirection === 1) {
                this.paddle.physicsImpostor.setLinearVelocity(BABYLON.Vector3.Right().scale(this.movementSpeed));
            } else {
                this.paddle.physicsImpostor.setLinearVelocity(BABYLON.Vector3.Zero());
            }
        }
    }, {
        key: 'update',
        value: function update(keyStates, ball) {
            if (!this.isAI) this.movePaddle(keyStates);else this.movePaddleAI(ball);

            this.paddle.physicsImpostor.setAngularVelocity(BABYLON.Vector3.Zero());
        }
    }]);

    return Paddle;
}();
/// <reference path="./../../typings/babylon.d.ts" />
/// <reference path="./paddle.js" />
/// <reference path="./ball.js" />

// ToDo: Remove `showBoundingBox` from all bodies

var canvasHolder = document.getElementById('canvas-holder');
var canvas = document.createElement('canvas');
canvas.width = window.innerWidth - 25;
canvas.height = window.innerHeight - 30;
canvasHolder.appendChild(canvas);
var engine = new BABYLON.Engine(canvas, true);

var keyStates = {
    32: false, // SPACE
    37: false, // LEFT
    38: false, // UP
    39: false, // RIGHT
    40: false // DOWN
};
window.addEventListener('keydown', function (event) {
    if (event.keyCode in keyStates) keyStates[event.keyCode] = true;
});
window.addEventListener('keyup', function (event) {
    if (event.keyCode in keyStates) keyStates[event.keyCode] = false;
});

var createScene = function createScene() {
    var scene = new BABYLON.Scene(engine);
    scene.enablePhysics(new BABYLON.Vector3(0, -9.81, 0), new BABYLON.CannonJSPlugin());
    scene.collisionsEnabled = true;
    scene.workerCollisions = true;

    var camera = new BABYLON.FreeCamera('mainCamera', new BABYLON.Vector3(0, 20, -60), scene);
    camera.setTarget(BABYLON.Vector3.Zero());

    var light = new BABYLON.HemisphericLight('mainLight', new BABYLON.Vector3(0, 1, 0), scene);

    var ground = BABYLON.MeshBuilder.CreateGround('mainGround', {
        width: 32,
        height: 70,
        subdivisions: 2
    }, scene);
    ground.position = BABYLON.Vector3.Zero();
    ground.physicsImpostor = new BABYLON.PhysicsImpostor(ground, BABYLON.PhysicsImpostor.BoxImpostor, {
        mass: 0,
        friction: 0,
        restitution: 0
    }, scene);

    var leftBar = BABYLON.MeshBuilder.CreateBox('leftBar', {
        width: 2,
        height: 2,
        depth: 70
    }, scene);
    leftBar.position = new BABYLON.Vector3(-15, 1, 0);
    leftBar.physicsImpostor = new BABYLON.PhysicsImpostor(leftBar, BABYLON.PhysicsImpostor.BoxImpostor, {
        mass: 0,
        friction: 0,
        restitution: 1
    });

    var rightBar = BABYLON.MeshBuilder.CreateBox('rightBar', {
        width: 2,
        height: 2,
        depth: 70
    }, scene);
    rightBar.position = new BABYLON.Vector3(15, 1, 0);
    rightBar.physicsImpostor = new BABYLON.PhysicsImpostor(rightBar, BABYLON.PhysicsImpostor.BoxImpostor, {
        mass: 0,
        friction: 0,
        restitution: 1
    });

    return scene;
};
var scene = createScene();
// new BABYLON.Vector3(0, 0.5, -34)

var player_1 = new Paddle('player_1', scene, new BABYLON.Vector3(0, 0.5, -34), 2, false);
var aiPlayer = new Paddle('aiPlayer', scene, new BABYLON.Vector3(0, 0.5, 34), 3, true);
var playingBall = new Ball(scene, new BABYLON.Vector3(0, 0.5, -33), 1);

engine.runRenderLoop(function () {
    playingBall.update(player_1.paddle);
    player_1.update(keyStates, playingBall.ball);
    aiPlayer.update(keyStates, playingBall.ball);
    scene.render();
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImJ1bmRsZS5qcyJdLCJuYW1lcyI6WyJCYWxsIiwic2NlbmUiLCJzcGF3blBvc2l0aW9uIiwiYmFsbElkIiwiY29sb3IiLCJtaW5CYWxsU3BlZWQiLCJtYXhCYWxsU3BlZWQiLCJiYWxsIiwiQkFCWUxPTiIsIk1lc2hCdWlsZGVyIiwiQ3JlYXRlU3BoZXJlIiwic2VnbWVudHMiLCJkaWFtZXRlciIsInBoeXNpY3NJbXBvc3RvciIsIlBoeXNpY3NJbXBvc3RvciIsIlNwaGVyZUltcG9zdG9yIiwibWFzcyIsImZyaWN0aW9uIiwicmVzdGl0dXRpb24iLCJwb3NpdGlvbiIsInVuaXF1ZUlkIiwiaW5pdGlhbFBvc2l0aW9uIiwiY2xvbmUiLCJpc0xhdW5jaGVkIiwicGxheWVyUGFkZGxlIiwicGxheWVyTW92ZW1lbnRTcGVlZCIsImltcG9zdGVycyIsInJlZ2lzdGVyT25QaHlzaWNzQ29sbGlkZSIsIm9uVHJpZ2dlckVudGVyIiwiY29sbGlkZWRBZ2FpbnN0IiwidmVsb2NpdHlYIiwiZ2V0TGluZWFyVmVsb2NpdHkiLCJ4IiwidmVsb2NpdHlYQmFsbCIsInZlbG9jaXR5WiIsInoiLCJzZXRMaW5lYXJWZWxvY2l0eSIsIlZlY3RvcjMiLCJzZXRBbmd1bGFyVmVsb2NpdHkiLCJaZXJvIiwidmVsb2NpdHlaQWJzIiwiTWF0aCIsImFicyIsImNsYW1wZWRWZWxvY2l0eVoiLCJNYXRoVG9vbHMiLCJDbGFtcCIsImRpcmVjdGlvbiIsInNpZ24iLCJQYWRkbGUiLCJuYW1lIiwicGFkZGxlSWQiLCJpc0FJIiwicGFkZGxlIiwiQ3JlYXRlQm94Iiwid2lkdGgiLCJoZWlnaHQiLCJkZXB0aCIsIkJveEltcG9zdG9yIiwibW92ZW1lbnRTcGVlZCIsImtleVN0YXRlcyIsIkxlZnQiLCJzY2FsZSIsIlJpZ2h0IiwiZGVzaXJlZERpcmVjdGlvbiIsIm1vdmVQYWRkbGUiLCJtb3ZlUGFkZGxlQUkiLCJjYW52YXNIb2xkZXIiLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwiY2FudmFzIiwiY3JlYXRlRWxlbWVudCIsIndpbmRvdyIsImlubmVyV2lkdGgiLCJpbm5lckhlaWdodCIsImFwcGVuZENoaWxkIiwiZW5naW5lIiwiRW5naW5lIiwiYWRkRXZlbnRMaXN0ZW5lciIsImV2ZW50Iiwia2V5Q29kZSIsImNyZWF0ZVNjZW5lIiwiU2NlbmUiLCJlbmFibGVQaHlzaWNzIiwiQ2Fubm9uSlNQbHVnaW4iLCJjb2xsaXNpb25zRW5hYmxlZCIsIndvcmtlckNvbGxpc2lvbnMiLCJjYW1lcmEiLCJGcmVlQ2FtZXJhIiwic2V0VGFyZ2V0IiwibGlnaHQiLCJIZW1pc3BoZXJpY0xpZ2h0IiwiZ3JvdW5kIiwiQ3JlYXRlR3JvdW5kIiwic3ViZGl2aXNpb25zIiwibGVmdEJhciIsInJpZ2h0QmFyIiwicGxheWVyXzEiLCJhaVBsYXllciIsInBsYXlpbmdCYWxsIiwicnVuUmVuZGVyTG9vcCIsInVwZGF0ZSIsInJlbmRlciJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUE7O0lBRU1BLEk7QUFDRixrQkFBWUMsS0FBWixFQUFtQkMsYUFBbkIsRUFBa0NDLE1BQWxDLEVBQXFEO0FBQUEsWUFBWEMsS0FBVyx1RUFBSCxDQUFHOztBQUFBOztBQUNqRCxhQUFLQyxZQUFMLEdBQW9CLENBQXBCO0FBQ0EsYUFBS0MsWUFBTCxHQUFvQixFQUFwQjs7QUFFQSxhQUFLQyxJQUFMLEdBQVlDLFFBQVFDLFdBQVIsQ0FBb0JDLFlBQXBCLENBQWlDLFVBQWpDLEVBQTZDO0FBQ3JEQyxzQkFBVSxFQUQyQztBQUVyREMsc0JBQVU7QUFGMkMsU0FBN0MsRUFHVFgsS0FIUyxDQUFaO0FBSUEsYUFBS00sSUFBTCxDQUFVTSxlQUFWLEdBQTRCLElBQUlMLFFBQVFNLGVBQVosQ0FDeEIsS0FBS1AsSUFEbUIsRUFFeEJDLFFBQVFNLGVBQVIsQ0FBd0JDLGNBRkEsRUFFZ0I7QUFDcENDLGtCQUFNLENBRDhCO0FBRXBDQyxzQkFBVSxDQUYwQjtBQUdwQ0MseUJBQWE7QUFIdUIsU0FGaEIsRUFPeEJqQixLQVB3QixDQUE1QjtBQVNB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QnVDLFlBQVkzRixJQUF2QztBQUNBTixVQUFNb0csTUFBTjtBQUNILENBTEQiLCJmaWxlIjoiYnVuZGxlLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy8vIDxyZWZlcmVuY2UgcGF0aD1cIi4vLi4vLi4vdHlwaW5ncy9iYWJ5bG9uLmQudHNcIiAvPlxyXG5cclxuY2xhc3MgQmFsbCB7XHJcbiAgICBjb25zdHJ1Y3RvcihzY2VuZSwgc3Bhd25Qb3NpdGlvbiwgYmFsbElkLCBjb2xvciA9IDEpIHtcclxuICAgICAgICB0aGlzLm1pbkJhbGxTcGVlZCA9IDU7XHJcbiAgICAgICAgdGhpcy5tYXhCYWxsU3BlZWQgPSAyMDtcclxuXHJcbiAgICAgICAgdGhpcy5iYWxsID0gQkFCWUxPTi5NZXNoQnVpbGRlci5DcmVhdGVTcGhlcmUoJ3BsYXlCYWxsJywge1xyXG4gICAgICAgICAgICBzZWdtZW50czogMTYsXHJcbiAgICAgICAgICAgIGRpYW1ldGVyOiAxXHJcbiAgICAgICAgfSwgc2NlbmUpO1xyXG4gICAgICAgIHRoaXMuYmFsbC5waHlzaWNzSW1wb3N0b3IgPSBuZXcgQkFCWUxPTi5QaHlzaWNzSW1wb3N0b3IoXHJcbiAgICAgICAgICAgIHRoaXMuYmFsbCxcclxuICAgICAgICAgICAgQkFCWUxPTi5QaHlzaWNzSW1wb3N0b3IuU3BoZXJlSW1wb3N0b3IsIHtcclxuICAgICAgICAgICAgICAgIG1hc3M6IDEsXHJcbiAgICAgICAgICAgICAgICBmcmljdGlvbjogMCxcclxuICAgICAgICAgICAgICAgIHJlc3RpdHV0aW9uOiAxXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHNjZW5lXHJcbiAgICAgICAgKTtcclxuICAgICAgICB0aGlzLmJhbGwucG9zaXRpb24gPSBzcGF3blBvc2l0aW9uO1xyXG4gICAgICAgIHRoaXMuYmFsbC5waHlzaWNzSW1wb3N0b3IudW5pcXVlSWQgPSBiYWxsSWQ7XHJcblxyXG4gICAgICAgIHRoaXMuaW5pdGlhbFBvc2l0aW9uID0gc3Bhd25Qb3NpdGlvbi5jbG9uZSgpO1xyXG4gICAgICAgIHRoaXMuaXNMYXVuY2hlZCA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMuY29sb3IgPSBjb2xvcjtcclxuICAgIH1cclxuXHJcbiAgICBsb2NrUG9zaXRpb25Ub1BsYXllclBhZGRsZShwbGF5ZXJQYWRkbGUsIHBsYXllck1vdmVtZW50U3BlZWQpIHtcclxuXHJcbiAgICB9XHJcblxyXG4gICAgc2V0Q29sbGlzaW9uQ29tcG9uZW50cyhpbXBvc3RlcnMpIHtcclxuICAgICAgICB0aGlzLmJhbGwucGh5c2ljc0ltcG9zdG9yLnJlZ2lzdGVyT25QaHlzaWNzQ29sbGlkZShpbXBvc3RlcnMsIHRoaXMub25UcmlnZ2VyRW50ZXIpO1xyXG4gICAgfVxyXG5cclxuICAgIG9uVHJpZ2dlckVudGVyKGJhbGwsIGNvbGxpZGVkQWdhaW5zdCkge1xyXG4gICAgICAgIGxldCB2ZWxvY2l0eVggPSBjb2xsaWRlZEFnYWluc3QuZ2V0TGluZWFyVmVsb2NpdHkoKS54O1xyXG4gICAgICAgIGxldCB2ZWxvY2l0eVhCYWxsID0gYmFsbC5nZXRMaW5lYXJWZWxvY2l0eSgpLng7XHJcbiAgICAgICAgbGV0IHZlbG9jaXR5WiA9IC1iYWxsLmdldExpbmVhclZlbG9jaXR5KCkuejtcclxuXHJcbiAgICAgICAgYmFsbC5zZXRMaW5lYXJWZWxvY2l0eShuZXcgQkFCWUxPTi5WZWN0b3IzKFxyXG4gICAgICAgICAgICB2ZWxvY2l0eVggLSB2ZWxvY2l0eVhCYWxsLFxyXG4gICAgICAgICAgICAwLFxyXG4gICAgICAgICAgICB2ZWxvY2l0eVpcclxuICAgICAgICApKTtcclxuXHJcbiAgICAgICAgY29sbGlkZWRBZ2FpbnN0LnNldEFuZ3VsYXJWZWxvY2l0eShCQUJZTE9OLlZlY3RvcjMuWmVybygpKTtcclxuICAgIH1cclxuXHJcbiAgICB1cGRhdGUoKSB7XHJcbiAgICAgICAgbGV0IHZlbG9jaXR5WiA9IHRoaXMuYmFsbC5waHlzaWNzSW1wb3N0b3IuZ2V0TGluZWFyVmVsb2NpdHkoKS56O1xyXG4gICAgICAgIGxldCB2ZWxvY2l0eVpBYnMgPSBNYXRoLmFicyh2ZWxvY2l0eVopO1xyXG4gICAgICAgIGxldCBjbGFtcGVkVmVsb2NpdHlaID0gQkFCWUxPTi5NYXRoVG9vbHMuQ2xhbXAodmVsb2NpdHlaQWJzLCB0aGlzLm1pbkJhbGxTcGVlZCwgdGhpcy5tYXhCYWxsU3BlZWQpO1xyXG4gICAgICAgIGxldCBkaXJlY3Rpb24gPSBNYXRoLnNpZ24odmVsb2NpdHlaKTtcclxuXHJcbiAgICAgICAgbGV0IHZlbG9jaXR5WCA9IHRoaXMuYmFsbC5waHlzaWNzSW1wb3N0b3IuZ2V0TGluZWFyVmVsb2NpdHkoKS54O1xyXG5cclxuICAgICAgICB0aGlzLmJhbGwucGh5c2ljc0ltcG9zdG9yLnNldExpbmVhclZlbG9jaXR5KFxyXG4gICAgICAgICAgICBuZXcgQkFCWUxPTi5WZWN0b3IzKFxyXG4gICAgICAgICAgICAgICAgdmVsb2NpdHlYLFxyXG4gICAgICAgICAgICAgICAgMCxcclxuICAgICAgICAgICAgICAgIGNsYW1wZWRWZWxvY2l0eVogKiBkaXJlY3Rpb25cclxuICAgICAgICAgICAgKVxyXG4gICAgICAgICk7XHJcbiAgICB9XHJcbn1cbi8vLyA8cmVmZXJlbmNlIHBhdGg9XCIuLy4uLy4uL3R5cGluZ3MvYmFieWxvbi5kLnRzXCIgLz5cclxuXHJcbmNsYXNzIFBhZGRsZSB7XHJcbiAgICBjb25zdHJ1Y3RvcihuYW1lLCBzY2VuZSwgc3Bhd25Qb3NpdGlvbiwgcGFkZGxlSWQsIGlzQUksIGNvbG9yID0gMSkge1xyXG4gICAgICAgIHRoaXMucGFkZGxlID0gQkFCWUxPTi5NZXNoQnVpbGRlci5DcmVhdGVCb3goYHBhZGRsZSR7bmFtZX1gLCB7XHJcbiAgICAgICAgICAgIHdpZHRoOiA1LFxyXG4gICAgICAgICAgICBoZWlnaHQ6IDEsXHJcbiAgICAgICAgICAgIGRlcHRoOiAxXHJcbiAgICAgICAgfSwgc2NlbmUpO1xyXG4gICAgICAgIHRoaXMucGFkZGxlLnBvc2l0aW9uID0gc3Bhd25Qb3NpdGlvbjtcclxuICAgICAgICB0aGlzLnBhZGRsZS5waHlzaWNzSW1wb3N0b3IgPSBuZXcgQkFCWUxPTi5QaHlzaWNzSW1wb3N0b3IoXHJcbiAgICAgICAgICAgIHRoaXMucGFkZGxlLFxyXG4gICAgICAgICAgICBCQUJZTE9OLlBoeXNpY3NJbXBvc3Rvci5Cb3hJbXBvc3Rvciwge1xyXG4gICAgICAgICAgICAgICAgbWFzczogMSxcclxuICAgICAgICAgICAgICAgIGZyaWN0aW9uOiAwLFxyXG4gICAgICAgICAgICAgICAgcmVzdGl0dXRpb246IDBcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgc2NlbmVcclxuICAgICAgICApO1xyXG4gICAgICAgIHRoaXMucGFkZGxlLnBoeXNpY3NJbXBvc3Rvci5zZXRMaW5lYXJWZWxvY2l0eShCQUJZTE9OLlZlY3RvcjMuWmVybygpKTtcclxuICAgICAgICB0aGlzLnBhZGRsZS5waHlzaWNzSW1wb3N0b3IudW5pcXVlSWQgPSBwYWRkbGVJZDtcclxuXHJcbiAgICAgICAgdGhpcy5pbml0aWFsUG9zaXRpb24gPSBzcGF3blBvc2l0aW9uLmNsb25lKCk7XHJcbiAgICAgICAgdGhpcy5jb2xvciA9IGNvbG9yO1xyXG4gICAgICAgIHRoaXMubW92ZW1lbnRTcGVlZCA9IDU7XHJcblxyXG4gICAgICAgIHRoaXMuaXNBSSA9IGlzQUk7XHJcbiAgICB9XHJcblxyXG4gICAgbW92ZVBhZGRsZShrZXlTdGF0ZXMpIHtcclxuICAgICAgICBpZiAoa2V5U3RhdGVzWzM3XSkge1xyXG4gICAgICAgICAgICB0aGlzLnBhZGRsZS5waHlzaWNzSW1wb3N0b3Iuc2V0TGluZWFyVmVsb2NpdHkoQkFCWUxPTi5WZWN0b3IzLkxlZnQoKS5zY2FsZSh0aGlzLm1vdmVtZW50U3BlZWQpKTtcclxuICAgICAgICB9IGVsc2UgaWYgKGtleVN0YXRlc1szOV0pIHtcclxuICAgICAgICAgICAgdGhpcy5wYWRkbGUucGh5c2ljc0ltcG9zdG9yLnNldExpbmVhclZlbG9jaXR5KEJBQllMT04uVmVjdG9yMy5SaWdodCgpLnNjYWxlKHRoaXMubW92ZW1lbnRTcGVlZCkpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKCgha2V5U3RhdGVzWzM3XSAmJiAha2V5U3RhdGVzWzM5XSkgfHwgKGtleVN0YXRlc1szN10gJiYga2V5U3RhdGVzWzM5XSkpXHJcbiAgICAgICAgICAgIHRoaXMucGFkZGxlLnBoeXNpY3NJbXBvc3Rvci5zZXRMaW5lYXJWZWxvY2l0eShCQUJZTE9OLlZlY3RvcjMuWmVybygpKTtcclxuICAgIH1cclxuXHJcbiAgICBtb3ZlUGFkZGxlQUkoYmFsbCkge1xyXG4gICAgICAgIGxldCBkZXNpcmVkRGlyZWN0aW9uID0gTWF0aC5zaWduKGJhbGwucG9zaXRpb24ueCAtIHRoaXMucGFkZGxlLnBvc2l0aW9uLngpO1xyXG5cclxuICAgICAgICBpZiAoZGVzaXJlZERpcmVjdGlvbiA9PT0gLTEpIHtcclxuICAgICAgICAgICAgdGhpcy5wYWRkbGUucGh5c2ljc0ltcG9zdG9yLnNldExpbmVhclZlbG9jaXR5KEJBQllMT04uVmVjdG9yMy5MZWZ0KCkuc2NhbGUodGhpcy5tb3ZlbWVudFNwZWVkKSk7XHJcbiAgICAgICAgfSBlbHNlIGlmIChkZXNpcmVkRGlyZWN0aW9uID09PSAxKSB7XHJcbiAgICAgICAgICAgIHRoaXMucGFkZGxlLnBoeXNpY3NJbXBvc3Rvci5zZXRMaW5lYXJWZWxvY2l0eShCQUJZTE9OLlZlY3RvcjMuUmlnaHQoKS5zY2FsZSh0aGlzLm1vdmVtZW50U3BlZWQpKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLnBhZGRsZS5waHlzaWNzSW1wb3N0b3Iuc2V0TGluZWFyVmVsb2NpdHkoQkFCWUxPTi5WZWN0b3IzLlplcm8oKSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHVwZGF0ZShrZXlTdGF0ZXMsIGJhbGwpIHtcclxuICAgICAgICBpZiAoIXRoaXMuaXNBSSlcclxuICAgICAgICAgICAgdGhpcy5tb3ZlUGFkZGxlKGtleVN0YXRlcyk7XHJcbiAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICB0aGlzLm1vdmVQYWRkbGVBSShiYWxsKTtcclxuXHJcbiAgICAgICAgdGhpcy5wYWRkbGUucGh5c2ljc0ltcG9zdG9yLnNldEFuZ3VsYXJWZWxvY2l0eShCQUJZTE9OLlZlY3RvcjMuWmVybygpKTtcclxuICAgIH1cclxufVxuLy8vIDxyZWZlcmVuY2UgcGF0aD1cIi4vLi4vLi4vdHlwaW5ncy9iYWJ5bG9uLmQudHNcIiAvPlxyXG4vLy8gPHJlZmVyZW5jZSBwYXRoPVwiLi9wYWRkbGUuanNcIiAvPlxyXG4vLy8gPHJlZmVyZW5jZSBwYXRoPVwiLi9iYWxsLmpzXCIgLz5cclxuXHJcbi8vIFRvRG86IFJlbW92ZSBgc2hvd0JvdW5kaW5nQm94YCBmcm9tIGFsbCBib2RpZXNcclxuXHJcbmNvbnN0IGNhbnZhc0hvbGRlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjYW52YXMtaG9sZGVyJyk7XHJcbmNvbnN0IGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpO1xyXG5jYW52YXMud2lkdGggPSB3aW5kb3cuaW5uZXJXaWR0aCAtIDI1O1xyXG5jYW52YXMuaGVpZ2h0ID0gd2luZG93LmlubmVySGVpZ2h0IC0gMzA7XHJcbmNhbnZhc0hvbGRlci5hcHBlbmRDaGlsZChjYW52YXMpO1xyXG5jb25zdCBlbmdpbmUgPSBuZXcgQkFCWUxPTi5FbmdpbmUoY2FudmFzLCB0cnVlKTtcclxuXHJcbmNvbnN0IGtleVN0YXRlcyA9IHtcclxuICAgIDMyOiBmYWxzZSwgLy8gU1BBQ0VcclxuICAgIDM3OiBmYWxzZSwgLy8gTEVGVFxyXG4gICAgMzg6IGZhbHNlLCAvLyBVUFxyXG4gICAgMzk6IGZhbHNlLCAvLyBSSUdIVFxyXG4gICAgNDA6IGZhbHNlIC8vIERPV05cclxufTtcclxud2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCAoZXZlbnQpID0+IHtcclxuICAgIGlmIChldmVudC5rZXlDb2RlIGluIGtleVN0YXRlcylcclxuICAgICAgICBrZXlTdGF0ZXNbZXZlbnQua2V5Q29kZV0gPSB0cnVlO1xyXG59KTtcclxud2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2tleXVwJywgKGV2ZW50KSA9PiB7XHJcbiAgICBpZiAoZXZlbnQua2V5Q29kZSBpbiBrZXlTdGF0ZXMpXHJcbiAgICAgICAga2V5U3RhdGVzW2V2ZW50LmtleUNvZGVdID0gZmFsc2U7XHJcbn0pO1xyXG5cclxuY29uc3QgY3JlYXRlU2NlbmUgPSAoKSA9PiB7XHJcbiAgICBjb25zdCBzY2VuZSA9IG5ldyBCQUJZTE9OLlNjZW5lKGVuZ2luZSk7XHJcbiAgICBzY2VuZS5lbmFibGVQaHlzaWNzKG5ldyBCQUJZTE9OLlZlY3RvcjMoMCwgLTkuODEsIDApLCBuZXcgQkFCWUxPTi5DYW5ub25KU1BsdWdpbigpKTtcclxuICAgIHNjZW5lLmNvbGxpc2lvbnNFbmFibGVkID0gdHJ1ZTtcclxuICAgIHNjZW5lLndvcmtlckNvbGxpc2lvbnMgPSB0cnVlO1xyXG5cclxuICAgIGNvbnN0IGNhbWVyYSA9IG5ldyBCQUJZTE9OLkZyZWVDYW1lcmEoJ21haW5DYW1lcmEnLCBuZXcgQkFCWUxPTi5WZWN0b3IzKDAsIDIwLCAtNjApLCBzY2VuZSk7XHJcbiAgICBjYW1lcmEuc2V0VGFyZ2V0KEJBQllMT04uVmVjdG9yMy5aZXJvKCkpO1xyXG5cclxuICAgIGNvbnN0IGxpZ2h0ID0gbmV3IEJBQllMT04uSGVtaXNwaGVyaWNMaWdodCgnbWFpbkxpZ2h0JywgbmV3IEJBQllMT04uVmVjdG9yMygwLCAxLCAwKSwgc2NlbmUpO1xyXG5cclxuICAgIGNvbnN0IGdyb3VuZCA9IEJBQllMT04uTWVzaEJ1aWxkZXIuQ3JlYXRlR3JvdW5kKCdtYWluR3JvdW5kJywge1xyXG4gICAgICAgIHdpZHRoOiAzMixcclxuICAgICAgICBoZWlnaHQ6IDcwLFxyXG4gICAgICAgIHN1YmRpdmlzaW9uczogMlxyXG4gICAgfSwgc2NlbmUpO1xyXG4gICAgZ3JvdW5kLnBvc2l0aW9uID0gQkFCWUxPTi5WZWN0b3IzLlplcm8oKTtcclxuICAgIGdyb3VuZC5waHlzaWNzSW1wb3N0b3IgPSBuZXcgQkFCWUxPTi5QaHlzaWNzSW1wb3N0b3IoXHJcbiAgICAgICAgZ3JvdW5kLFxyXG4gICAgICAgIEJBQllMT04uUGh5c2ljc0ltcG9zdG9yLkJveEltcG9zdG9yLCB7XHJcbiAgICAgICAgICAgIG1hc3M6IDAsXHJcbiAgICAgICAgICAgIGZyaWN0aW9uOiAwLFxyXG4gICAgICAgICAgICByZXN0aXR1dGlvbjogMFxyXG4gICAgICAgIH0sIHNjZW5lKTtcclxuXHJcbiAgICBjb25zdCBsZWZ0QmFyID0gQkFCWUxPTi5NZXNoQnVpbGRlci5DcmVhdGVCb3goJ2xlZnRCYXInLCB7XHJcbiAgICAgICAgd2lkdGg6IDIsXHJcbiAgICAgICAgaGVpZ2h0OiAyLFxyXG4gICAgICAgIGRlcHRoOiA3MFxyXG4gICAgfSwgc2NlbmUpO1xyXG4gICAgbGVmdEJhci5wb3NpdGlvbiA9IG5ldyBCQUJZTE9OLlZlY3RvcjMoLTE1LCAxLCAwKTtcclxuICAgIGxlZnRCYXIucGh5c2ljc0ltcG9zdG9yID0gbmV3IEJBQllMT04uUGh5c2ljc0ltcG9zdG9yKFxyXG4gICAgICAgIGxlZnRCYXIsXHJcbiAgICAgICAgQkFCWUxPTi5QaHlzaWNzSW1wb3N0b3IuQm94SW1wb3N0b3IsIHtcclxuICAgICAgICAgICAgbWFzczogMCxcclxuICAgICAgICAgICAgZnJpY3Rpb246IDAsXHJcbiAgICAgICAgICAgIHJlc3RpdHV0aW9uOiAxXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgY29uc3QgcmlnaHRCYXIgPSBCQUJZTE9OLk1lc2hCdWlsZGVyLkNyZWF0ZUJveCgncmlnaHRCYXInLCB7XHJcbiAgICAgICAgd2lkdGg6IDIsXHJcbiAgICAgICAgaGVpZ2h0OiAyLFxyXG4gICAgICAgIGRlcHRoOiA3MFxyXG4gICAgfSwgc2NlbmUpO1xyXG4gICAgcmlnaHRCYXIucG9zaXRpb24gPSBuZXcgQkFCWUxPTi5WZWN0b3IzKDE1LCAxLCAwKTtcclxuICAgIHJpZ2h0QmFyLnBoeXNpY3NJbXBvc3RvciA9IG5ldyBCQUJZTE9OLlBoeXNpY3NJbXBvc3RvcihcclxuICAgICAgICByaWdodEJhcixcclxuICAgICAgICBCQUJZTE9OLlBoeXNpY3NJbXBvc3Rvci5Cb3hJbXBvc3Rvciwge1xyXG4gICAgICAgICAgICBtYXNzOiAwLFxyXG4gICAgICAgICAgICBmcmljdGlvbjogMCxcclxuICAgICAgICAgICAgcmVzdGl0dXRpb246IDFcclxuICAgICAgICB9KTtcclxuXHJcbiAgICByZXR1cm4gc2NlbmU7XHJcbn07XHJcbmNvbnN0IHNjZW5lID0gY3JlYXRlU2NlbmUoKTtcclxuLy8gbmV3IEJBQllMT04uVmVjdG9yMygwLCAwLjUsIC0zNClcclxuXHJcbmNvbnN0IHBsYXllcl8xID0gbmV3IFBhZGRsZSgncGxheWVyXzEnLCBzY2VuZSwgbmV3IEJBQllMT04uVmVjdG9yMygwLCAwLjUsIC0zNCksIDIsIGZhbHNlKTtcclxuY29uc3QgYWlQbGF5ZXIgPSBuZXcgUGFkZGxlKCdhaVBsYXllcicsIHNjZW5lLCBuZXcgQkFCWUxPTi5WZWN0b3IzKDAsIDAuNSwgMzQpLCAzLCB0cnVlKTtcclxuY29uc3QgcGxheWluZ0JhbGwgPSBuZXcgQmFsbChzY2VuZSwgbmV3IEJBQllMT04uVmVjdG9yMygwLCAwLjUsIC0zMyksIDEpO1xyXG5cclxuZW5naW5lLnJ1blJlbmRlckxvb3AoKCkgPT4ge1xyXG4gICAgcGxheWluZ0JhbGwudXBkYXRlKHBsYXllcl8xLnBhZGRsZSk7XHJcbiAgICBwbGF5ZXJfMS51cGRhdGUoa2V5U3RhdGVzLCBwbGF5aW5nQmFsbC5iYWxsKTtcclxuICAgIGFpUGxheWVyLnVwZGF0ZShrZXlTdGF0ZXMsIHBsYXlpbmdCYWxsLmJhbGwpO1xyXG4gICAgc2NlbmUucmVuZGVyKCk7XHJcbn0pOyJdfQ==
